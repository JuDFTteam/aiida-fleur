

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.tools.codespecific.fleur.xml_util &mdash; Fleur plugin 0.27 beta documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Fleur plugin 0.27 beta documentation" href="../../../../../index.html"/>
        <link rel="up" title="Module code" href="../../../../index.html"/> 

  
  <script src="../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../index.html" class="icon icon-home"> Fleur plugin
          

          
          </a>

          
            
            
              <div class="version">
                0.27 beta
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../plugin/fleur_plugin.html">Fleur-plugin</a></li>
</ul>
<ul class="simple">
</ul>
<ul class="simple">
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../code.html">Plug-in Classes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../../index.html">Fleur plugin</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
      
    <li>aiida.tools.codespecific.fleur.xml_util</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.tools.codespecific.fleur.xml_util</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">In this module contains useful methods for handling xml trees and files which are used</span>
<span class="sd">by the Fleur plugin.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="p">(</span><span class="s">u&quot;Copyright (c), 2016, Forschungszentrum JÃ¼lich GmbH, &quot;</span>
         <span class="s">&quot;IAS-1/PGI-1, Germany. All rights reserved.&quot;</span><span class="p">)</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s">&quot;MIT license, see LICENSE.txt file&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;0.27&quot;</span>
<span class="n">__contributors__</span> <span class="o">=</span> <span class="s">&quot;Jens Broeder&quot;</span>


<span class="c"># TODO FEHLER meldungen, currently if a xpath expression is valid, but does not exists</span>
<span class="c"># xpath returns []. Do we want this behavior?</span>
<span class="c"># TODO finish implementation of create=False</span>
<span class="c"># TODO: no aiida imports</span>
<span class="kn">from</span> <span class="nn">aiida</span> <span class="kn">import</span> <span class="n">load_dbenv</span><span class="p">,</span> <span class="n">is_dbenv_loaded</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">is_dbenv_loaded</span><span class="p">():</span>
    <span class="n">load_dbenv</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">from</span> <span class="nn">lxml.etree</span> <span class="kn">import</span> <span class="n">XMLSyntaxError</span>

<span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="kn">import</span> <span class="n">InputValidationError</span>
<span class="c">#from somewhere import ValidationError</span>

<span class="k">def</span> <span class="nf">is_sequence</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="s">&quot;strip&quot;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="s">&quot;__getitem__&quot;</span><span class="p">)</span> <span class="ow">or</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="s">&quot;__iter__&quot;</span><span class="p">))</span>

<span class="c">##### CONVERTERS ############</span>

<div class="viewcode-block" id="convert_from_fortran_bool"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.convert_from_fortran_bool">[docs]</a><span class="k">def</span> <span class="nf">convert_from_fortran_bool</span><span class="p">(</span><span class="n">stringbool</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a string in this case (&#39;T&#39;, &#39;F&#39;, or &#39;t&#39;, &#39;f&#39;) to True or False</span>

<span class="sd">    :param stringbool: a string (&#39;t&#39;, &#39;f&#39;, &#39;F&#39;, &#39;T&#39;)</span>

<span class="sd">    :return: boolean  (either True or False)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">true_items</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;True&#39;</span><span class="p">,</span> <span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="s">&#39;T&#39;</span><span class="p">]</span>
    <span class="n">false_items</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;False&#39;</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="s">&#39;F&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stringbool</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">stringbool</span> <span class="ow">in</span> <span class="n">false_items</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">stringbool</span> <span class="ow">in</span> <span class="n">true_items</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span>
            <span class="s">&quot;A string: {} for a boolean was given, which is not &#39;True&#39;,&quot;</span>
            <span class="s">&quot; &#39;False&#39;, &#39;t&#39;, &#39;T&#39;, &#39;F&#39; or &#39;f&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stringbool</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;convert_to_fortran_bool accepts only a string or &quot;</span>
                     <span class="s">&quot;bool as argument&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="convert_to_fortran_bool"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.convert_to_fortran_bool">[docs]</a><span class="k">def</span> <span class="nf">convert_to_fortran_bool</span><span class="p">(</span><span class="n">boolean</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a Boolean as string to the format definded in the input</span>

<span class="sd">    :param boolean: either a boolean or a string (&#39;True&#39;, &#39;False&#39;, &#39;F&#39;, &#39;T&#39;)</span>

<span class="sd">    :return: a string (either &#39;t&#39; or &#39;f&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">boolean</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">boolean</span><span class="p">:</span>
            <span class="n">new_string</span> <span class="o">=</span> <span class="s">&#39;T&#39;</span>
            <span class="k">return</span> <span class="n">new_string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_string</span> <span class="o">=</span> <span class="s">&#39;F&#39;</span>
            <span class="k">return</span> <span class="n">new_string</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">boolean</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">boolean</span> <span class="o">==</span> <span class="s">&#39;True&#39;</span> <span class="ow">or</span> <span class="n">boolean</span> <span class="o">==</span> <span class="s">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">boolean</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span><span class="p">:</span>
            <span class="n">new_string</span> <span class="o">=</span> <span class="s">&#39;T&#39;</span>
            <span class="k">return</span> <span class="n">new_string</span>
        <span class="k">elif</span> <span class="n">boolean</span> <span class="o">==</span> <span class="s">&#39;False&#39;</span> <span class="ow">or</span> <span class="n">boolean</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span> <span class="ow">or</span> <span class="n">boolean</span> <span class="o">==</span> <span class="s">&#39;F&#39;</span><span class="p">:</span>
            <span class="n">new_string</span> <span class="o">=</span> <span class="s">&#39;F&#39;</span>
            <span class="k">return</span> <span class="n">new_string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span>
                <span class="s">&quot;A string: {} for a boolean was given, which is not &#39;True&#39;,&quot;</span>
                <span class="s">&quot;&#39;False&#39;, &#39;t&#39;, &#39;T&#39;, &#39;F&#39; or &#39;f&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">boolean</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
         <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;convert_to_fortran_bool accepts only a string or &quot;</span>
                         <span class="s">&quot;bool as argument, given {} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">boolean</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="convert_to_fortran_string"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.convert_to_fortran_string">[docs]</a><span class="k">def</span> <span class="nf">convert_to_fortran_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    converts some parameter strings to the format for the inpgen</span>
<span class="sd">    :param string: some string</span>
<span class="sd">    :returns: string in right format (extra &quot;&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_string</span> <span class="o">=</span> <span class="s">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">string</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span>
    <span class="k">return</span> <span class="n">new_string</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    if isinstance(string, str):</span>
<span class="sd">        new_string = &#39;&quot;&#39; + string + &#39;&quot;&#39;</span>
<span class="sd">        print new_string</span>
<span class="sd">        return new_string</span>
<span class="sd">        #if &#39;&quot;&#39; in string:</span>
<span class="sd">        #    return new_string</span>
<span class="sd">        #else:</span>
<span class="sd">        #    new_string = &#39;&quot;&#39; + string + &#39;&quot;&#39;</span>
<span class="sd">        #    return new_string</span>
<span class="sd">    else:</span>
<span class="sd">        print (string)</span>
<span class="sd">        #return string</span>
<span class="sd">        raise TypeError(&quot;_convert_to_fortran_string accepts only a&quot;</span>
<span class="sd">              &quot;string as argument, type {} given&quot;.format(type(string)))</span>
<span class="sd">    &#39;&#39;&#39;</span>


<span class="c">####### XML SETTERS GENERAL ##############</span>
</div>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">def xml_set_xpath(xmltree, xpathn, value):</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="sd">    root = xmltree.getroot()</span>
<span class="sd">    nodes = root.xpath(xpathn)</span>

<span class="sd">    if type(attribv) != type(&#39;&#39;):</span>
<span class="sd">        attribv = str(attribv)</span>
<span class="sd">    for node in nodes:</span>
<span class="sd">        node.set(attributename, attribv)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">def set_xpath(xmltree, xpath, value, create=False):</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="sd">    method to set a general xpath in an xml file</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="sd">    # does not work</span>
<span class="sd">    # set text?</span>

<span class="sd">    # set attribute?</span>
<span class="sd">    #print xpath</span>
<span class="sd">    #print value</span>
<span class="sd">    nodes = eval_xpath3(xmltree, xpathn, create=create)</span>
<span class="sd">    print nodes</span>
<span class="sd">    for node in nodes:</span>
<span class="sd">        node = value</span>
<span class="sd">&#39;&#39;&#39;</span>
<div class="viewcode-block" id="xml_set_attribv_occ"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.xml_set_attribv_occ">[docs]</a><span class="k">def</span> <span class="nf">xml_set_attribv_occ</span><span class="p">(</span><span class="n">xmltree</span><span class="p">,</span> <span class="n">xpathn</span><span class="p">,</span> <span class="n">attributename</span><span class="p">,</span> <span class="n">attribv</span><span class="p">,</span> <span class="n">occ</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">create</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Routine sets the value of an attribute in the xml file on only the places</span>
<span class="sd">    specified in occ</span>

<span class="sd">    :param: an etree a xpath from root to the attribute and the attribute value</span>
<span class="sd">    :param: occ, list of integers</span>
<span class="sd">    :return: None, or an etree</span>

<span class="sd">    Comment: Element.set will add the attribute if it does not exist,</span>
<span class="sd">             xpath expression has to exist</span>
<span class="sd">    example: xml_set_first_attribv(tree, &#39;/fleurInput/calculationSetup&#39;, &#39;band&#39;, &#39;T&#39;)</span>
<span class="sd">             xml_set_first_attribv(tree, &#39;/fleurInput/calculationSetup&#39;, &#39;dos&#39;, &#39;F&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">xmltree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">eval_xpath3</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">xpathn</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="n">create</span><span class="p">)</span>
    <span class="c">#print &#39;nodes from xml_set_attribv_occ: {}&#39;.format(nodes)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">attribv</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="n">attribv</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">attribv</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">occ</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">attributename</span><span class="p">,</span> <span class="n">attribv</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="xml_set_first_attribv"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.xml_set_first_attribv">[docs]</a><span class="k">def</span> <span class="nf">xml_set_first_attribv</span><span class="p">(</span><span class="n">xmltree</span><span class="p">,</span> <span class="n">xpathn</span><span class="p">,</span> <span class="n">attributename</span><span class="p">,</span> <span class="n">attribv</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Routine sets the value of an attribute in the xml file</span>

<span class="sd">    :param: an etree a xpath from root to the attribute and the attribute value</span>

<span class="sd">    :return: None, or an etree</span>

<span class="sd">    Comment: Element.set will add the attribute if it does not exist,</span>
<span class="sd">             xpath expression has to exist</span>
<span class="sd">    example: xml_set_first_attribv(tree, &#39;/fleurInput/calculationSetup&#39;, &#39;band&#39;, &#39;T&#39;)</span>
<span class="sd">             xml_set_first_attribv(tree, &#39;/fleurInput/calculationSetup&#39;, &#39;dos&#39;, &#39;F&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">xmltree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">attribv</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="n">eval_xpath3</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">xpathn</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="n">create</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">attributename</span><span class="p">,</span> <span class="n">attribv</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">eval_xpath3</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">xpathn</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="n">create</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">attributename</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">attribv</span><span class="p">))</span>
    <span class="c">#return xmltree</span>
    <span class="c">#ToDO check if worked. else exception,</span>
</div>
<div class="viewcode-block" id="xml_set_all_attribv"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.xml_set_all_attribv">[docs]</a><span class="k">def</span> <span class="nf">xml_set_all_attribv</span><span class="p">(</span><span class="n">xmltree</span><span class="p">,</span> <span class="n">xpathn</span><span class="p">,</span> <span class="n">attributename</span><span class="p">,</span> <span class="n">attribv</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Routine sets the value of an attribute in the xml file on all places it occurs</span>

<span class="sd">    :param: an etree a xpath from root to the attribute and the attribute value</span>

<span class="sd">    :return: None, or an etree</span>

<span class="sd">    Comment: Element.set will add the attribute if it does not exist,</span>
<span class="sd">             xpath expression has to exist</span>
<span class="sd">    example: xml_set_first_attribv(tree, &#39;/fleurInput/atomGroups/atomGroup/force&#39;, &#39;relaxXYZ&#39;, &#39;TTF&#39;)</span>
<span class="sd">             xml_set_first_attribv(tree, &#39;/fleurInput/atomGroups/atomGroup/force&#39;, &#39;calculate&#39;, &#39;F&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">xmltree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">eval_xpath3</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">xpathn</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="n">create</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_sequence</span><span class="p">(</span><span class="n">attribv</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span><span class="c">#type(attribv) != type(&#39;&#39;):</span>
                <span class="n">attribv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">attribv</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">attributename</span><span class="p">,</span> <span class="n">attribv</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribv</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span><span class="c">#type(attribv) != type(&#39;&#39;):</span>
            <span class="n">attribv</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">attribv</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">attributename</span><span class="p">,</span> <span class="n">attribv</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="xml_set_text"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.xml_set_text">[docs]</a><span class="k">def</span> <span class="nf">xml_set_text</span><span class="p">(</span><span class="n">xmltree</span><span class="p">,</span> <span class="n">xpathn</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">place_index</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tag_order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Routine sets the text of a tag in the xml file</span>
<span class="sd">    Input: an etree a xpath from root to the tag and the text</span>
<span class="sd">    Output: none, an etree</span>
<span class="sd">    example:</span>
<span class="sd">    xml_set_text(tree, &#39;/fleurInput/comment&#39;, &#39;Test Fleur calculation for AiiDA plug-in&#39;)</span>
<span class="sd">    but also cordinates and Bravais Matrix!:</span>
<span class="sd">    xml_set_text(tree, &#39;/fleurInput/atomGroups/atomGroup/relPos&#39;, &#39;1.20000 PI/3 5.1-MYCrazyCostant&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">xmltree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">eval_xpath3</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">xpathn</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="n">create</span><span class="p">,</span> <span class="n">place_index</span><span class="o">=</span><span class="n">place_index</span><span class="p">,</span> <span class="n">tag_order</span><span class="o">=</span><span class="n">tag_order</span><span class="p">)</span>
    <span class="c">#print node</span>
    <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
        <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="c">#return xmltree</span>
</div>
<div class="viewcode-block" id="xml_set_all_text"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.xml_set_all_text">[docs]</a><span class="k">def</span> <span class="nf">xml_set_all_text</span><span class="p">(</span><span class="n">xmltree</span><span class="p">,</span> <span class="n">xpathn</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Routine sets the text of a tag in the xml file</span>
<span class="sd">    Input: an etree a xpath from root to the tag and the text</span>
<span class="sd">    Output: none, an etree</span>
<span class="sd">    example:</span>
<span class="sd">    xml_set_text(tree, &#39;/fleurInput/comment&#39;, &#39;Test Fleur calculation for AiiDA plug-in&#39;)</span>
<span class="sd">    but also cordinates and Bravais Matrix!:</span>
<span class="sd">    xml_set_text(tree, &#39;/fleurInput/atomGroups/atomGroup/relPos&#39;, &#39;1.20000 PI/3 5.1-MYCrazyCostant&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">xmltree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">eval_xpath3</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">xpathn</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="n">create</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_sequence</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
</div>
<div class="viewcode-block" id="create_tag"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.create_tag">[docs]</a><span class="k">def</span> <span class="nf">create_tag</span><span class="p">(</span><span class="n">xmlnode</span><span class="p">,</span> <span class="n">xpath</span><span class="p">,</span> <span class="n">newelement</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">place_index</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">tag_order</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method evaluates an xpath expresion and creates tag in an xmltree under the </span>
<span class="sd">    returned nodes. If the path does exist things will be overriden, or created.</span>
<span class="sd">    Per default the new element is appended to the elements, but it can also be</span>
<span class="sd">    inserted in a certain position or after certain other tags.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#root = xmltree.getroot()</span>
    <span class="c">#print &#39;create_tag {} {} {} {} {} {}&#39;.format(xmlnode, xpath, newelement, create, place_index, tag_order)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">etree</span><span class="o">.</span><span class="n">iselement</span><span class="p">(</span><span class="n">newelement</span><span class="p">):</span>
        <span class="c">#print &#39;newelement from create_tag: {}&#39;.format(newelement)</span>
        <span class="c">#print &#39;xpath from create_tag: {}&#39;.format(xpath)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">newelement</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="n">newelement</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;{}. If this is a species, are you sure this species exists in your inp.xml?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">eval_xpath3</span><span class="p">(</span><span class="n">xmlnode</span><span class="p">,</span> <span class="n">xpath</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="n">create</span><span class="p">,</span> <span class="n">place_index</span><span class="o">=</span><span class="n">place_index</span><span class="p">,</span> <span class="n">tag_order</span><span class="o">=</span><span class="n">tag_order</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;nodes found from create_tag: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node_1</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">place_index</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tag_order</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;in tag_order&#39;</span>
                    <span class="c"># behind what shall I place it</span>
                    <span class="n">behind_tags</span> <span class="o">=</span> <span class="n">tag_order</span><span class="p">[:</span><span class="n">place_index</span><span class="p">]</span>
                    <span class="n">children</span> <span class="o">=</span> <span class="n">node_1</span><span class="o">.</span><span class="n">getchildren</span><span class="p">()</span>
                    <span class="k">print</span> <span class="n">children</span>
                    <span class="c"># get all names of tag exisiting tags</span>
                    <span class="nb">set</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">print</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">behind_tags</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">behind_tags</span><span class="p">):</span>
                        <span class="k">print</span> <span class="n">tag</span>
                        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node_1</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="nb">reversed</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
                            <span class="c"># if tagname of elements==tag:</span>
                            <span class="n">tag_index</span> <span class="o">=</span> <span class="n">node_1</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                            <span class="k">print</span> <span class="n">child</span>
                            <span class="k">print</span> <span class="n">tag_index</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">node_1</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tag_index</span><span class="p">,</span> <span class="n">newelement</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;{}. If this is a species, are you sure this species exists in your inp.xml?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                            <span class="nb">set</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="k">break</span>
                        <span class="k">if</span> <span class="nb">set</span><span class="p">:</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">:</span> <span class="c"># just append</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">node_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newelement</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;{}. If this is a species, are you sure this species exists in your inp.xml?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                    <span class="c"># (or remove all and write them again in right order?)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">node_1</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">place_index</span><span class="p">,</span> <span class="n">newelement</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;{}. If this is a species, are you sure this species exists in your inp.xml?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                    <span class="k">print</span> <span class="s">&#39;in place_index&#39;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;normal append&#39;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">node_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newelement</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;{}. If this is a species, are you sure this species exists in your inp.xml?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">xmlnode</span>
</div>
<span class="k">def</span> <span class="nf">delete_att</span><span class="p">(</span><span class="n">xmltree</span><span class="p">,</span> <span class="n">xpath</span><span class="p">,</span> <span class="n">attrib</span><span class="p">):</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">xmltree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">eval_xpath3</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">xpath</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">attrib</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">return</span> <span class="n">xmltree</span>

<span class="k">def</span> <span class="nf">delete_tag</span><span class="p">(</span><span class="n">xmltree</span><span class="p">,</span> <span class="n">xpath</span><span class="p">):</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">xmltree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">eval_xpath3</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">xpath</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xmltree</span>

<span class="k">def</span> <span class="nf">replace_tag</span><span class="p">(</span><span class="n">xmltree</span><span class="p">,</span> <span class="n">xpath</span><span class="p">,</span> <span class="n">newelement</span><span class="p">):</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">xmltree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>

    <span class="n">nodes</span> <span class="o">=</span> <span class="n">eval_xpath3</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">xpath</span><span class="p">)</span>
    <span class="c">#print nodes</span>
    <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="c">#print newelement</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newelement</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xmltree</span>
<span class="c">####### XML SETTERS SPECIAL ########</span>

<div class="viewcode-block" id="set_species"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.set_species">[docs]</a><span class="k">def</span> <span class="nf">set_species</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">species_name</span><span class="p">,</span> <span class="n">attributedict</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># TODO lowercase everything</span>
    <span class="c"># TODO make a general specifier for species, not only the name i.e. also number, other parameters</span>
    <span class="n">xpathspecies</span> <span class="o">=</span><span class="s">&#39;/fleurInput/atomSpecies/species[@name = &quot;{}&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">species_name</span><span class="p">)</span>
    <span class="n">xpathmt</span> <span class="o">=</span> <span class="s">&#39;{}/mtSphere&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathspecies</span><span class="p">)</span>
    <span class="n">xpathatomicCutoffs</span> <span class="o">=</span> <span class="s">&#39;{}/atomicCutoffs&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathspecies</span><span class="p">)</span>
    <span class="n">xpathenergyParameters</span> <span class="o">=</span> <span class="s">&#39;{}/energyParameters&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathspecies</span><span class="p">)</span>
    <span class="n">xpathlo</span> <span class="o">=</span> <span class="s">&#39;{}/lo&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathspecies</span><span class="p">)</span>
    <span class="n">xpathelectronConfig</span> <span class="o">=</span> <span class="s">&#39;{}/electronConfig&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathspecies</span><span class="p">)</span>
    <span class="n">xpathcoreocc</span> <span class="o">=</span> <span class="s">&#39;{}/electronConfig/stateOccupation&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathspecies</span><span class="p">)</span>
    <span class="n">xpathLDA_U</span> <span class="o">=</span> <span class="s">&#39;{}/ldaU&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathspecies</span><span class="p">)</span>
    <span class="n">xpathnocoParams</span> <span class="o">=</span> <span class="s">&#39;{}/nocoParams&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathspecies</span><span class="p">)</span>
    <span class="n">xpathnocoParamsqss</span> <span class="o">=</span> <span class="s">&#39;{}/nocoParams/qss&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathspecies</span><span class="p">)</span>

    <span class="c"># can we get this out of schema file?</span>
    <span class="n">species_seq</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;mtSphere&#39;</span><span class="p">,</span> <span class="s">&#39;atomicCutoffs&#39;</span><span class="p">,</span> <span class="s">&#39;energyParameters&#39;</span><span class="p">,</span> <span class="s">&#39;force&#39;</span><span class="p">,</span> <span class="s">&#39;electronConfig&#39;</span><span class="p">,</span> <span class="s">&#39;nocoParams&#39;</span><span class="p">,</span> <span class="s">&#39;ldaU&#39;</span><span class="p">,</span> <span class="s">&#39;lo&#39;</span><span class="p">]</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">fleurinp_tree_copy</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">attributedict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;mtSphere&#39;</span><span class="p">:</span> <span class="c"># always in inp.xml</span>
            <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">xml_set_attribv_occ</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathmt</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;atomicCutoffs&#39;</span><span class="p">:</span> <span class="c"># always in inp.xml</span>
            <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">xml_set_attribv_occ</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathatomicCutoffs</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;energyParameters&#39;</span><span class="p">:</span> <span class="c"># always in inp.xml</span>
            <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">xml_set_attribv_occ</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathenergyParameters</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;lo&#39;</span><span class="p">:</span> <span class="c"># optional in inp.xml</span>
            <span class="c">#policy: we DELETE all LOs, and create new ones from the given parameters.</span>
            <span class="n">existinglos</span> <span class="o">=</span> <span class="n">eval_xpath3</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathlo</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">los</span> <span class="ow">in</span> <span class="n">existinglos</span><span class="p">:</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">los</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">los</span><span class="p">)</span>

            <span class="c"># there can be multible LO tags, so I expect either one or a list</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">xml_set_attribv_occ</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathlo</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="n">create</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span><span class="c"># I expect a list of dicts</span>
                <span class="c">#lonodes = eval_xpath3(root, xpathlo)#, create=True, place_index=species_seq.index(&#39;lo&#39;), tag_order=species_seq)</span>
                <span class="c">#nlonodes = len(lonodes)</span>
                <span class="c">#print &#39;nlonodes:{}&#39;.format(nlonodes)</span>
                <span class="c">#ggf create more lo tags of needed</span>
                <span class="n">los_need</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="c"># - nlonodes</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">los_need</span><span class="p">):</span>
                    <span class="n">create_tag</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathspecies</span><span class="p">,</span> <span class="s">&#39;lo&#39;</span><span class="p">)</span><span class="c">#, place_index=species_seq.index(&#39;lo&#39;), tag_order=species_seq)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lodict</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">lodict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                        <span class="n">xml_set_attribv_occ</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathlo</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">occ</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;electronConfig&#39;</span><span class="p">:</span>
            <span class="c"># eval electronConfig and ggf create tag at right place.</span>
            <span class="k">print</span> <span class="s">&#39;index {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">species_seq</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;electronConfig&#39;</span><span class="p">))</span>
            <span class="n">eval_xpath3</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathelectronConfig</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">place_index</span><span class="o">=</span><span class="n">species_seq</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;electronConfig&#39;</span><span class="p">),</span> <span class="n">tag_order</span><span class="o">=</span><span class="n">species_seq</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;coreConfig&#39;</span><span class="p">,</span> <span class="s">&#39;valenceConfig&#39;</span><span class="p">,</span> <span class="s">&#39;stateOccupation&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">etag</span><span class="p">,</span> <span class="n">edictlist</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">etag</span> <span class="o">==</span> <span class="n">tag</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">etag</span><span class="o">==</span><span class="s">&#39;stateOccupation&#39;</span><span class="p">:</span><span class="c"># there can be multiple times stateOccupation</span>
                        <span class="c">#policy: we DELETE all LOs, and create new ones from the given parameters.</span>
                        <span class="n">existingocc</span> <span class="o">=</span> <span class="n">eval_xpath3</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathcoreocc</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">existingocc</span><span class="p">:</span>
                            <span class="n">parent</span> <span class="o">=</span> <span class="n">occ</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
                            <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">occ</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edictlist</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">edictlist</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                <span class="n">xml_set_attribv_occ</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathcoreocc</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="n">create</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span><span class="c"># I expect a list of dicts</span>
                            <span class="c">#occnodes = eval_xpath3(root, xpathcoreocc)</span>
                            <span class="c">#noccnodes = len(occnodes)</span>
                            <span class="c">#ggf create more lo tags of needed</span>
                            <span class="n">nodes_need</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="c"># - noccnodes</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nodes_need</span><span class="p">):</span>
                                <span class="n">create_tag</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathelectronConfig</span><span class="p">,</span> <span class="s">&#39;stateOccupation&#39;</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="n">create</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">occdict</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edictlist</span><span class="p">):</span>
                                <span class="c">#override them one after one</span>
                                <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">occdict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                                    <span class="n">xml_set_attribv_occ</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathcoreocc</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">occ</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="c">#print edictlist</span>
                        <span class="n">xpathconfig</span> <span class="o">=</span> <span class="n">xpathelectronConfig</span> <span class="o">+</span> <span class="s">&#39;/{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">etag</span><span class="p">)</span>
                        <span class="n">xml_set_text</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathconfig</span><span class="p">,</span> <span class="n">edictlist</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="n">create</span><span class="p">,</span> <span class="n">place_index</span><span class="o">=</span><span class="n">species_seq</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;electronConfig&#39;</span><span class="p">),</span> <span class="n">tag_order</span> <span class="o">=</span> <span class="n">species_seq</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;nocoParams&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">attrib</span> <span class="o">==</span> <span class="s">&#39;qss&#39;</span><span class="p">:</span>
                    <span class="n">xml_set_text</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathnocoParamsqss</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                   <span class="n">xml_set_attribv_occ</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathnocoParams</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;ldaU&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">xml_set_attribv_occ</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathLDA_U</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="n">create</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xml_set_all_attribv</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathspecies</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fleurinp_tree_copy</span>
</div>
<span class="k">def</span> <span class="nf">add_lo</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">species_name</span><span class="p">,</span> <span class="n">attributedict</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">change_atomgr_att</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">attributedict</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">create</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

    <span class="n">xpathatmgroup</span> <span class="o">=</span> <span class="s">&#39;/fleurInput/atomGroups/atomGroup&#39;</span>
    <span class="n">xpathforce</span> <span class="o">=</span> <span class="s">&#39;{}/force&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathatmgroup</span><span class="p">)</span>
    <span class="n">xpathnocoParams</span> <span class="o">=</span> <span class="s">&#39;{}/nocoParams&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathatmgroup</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">position</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">species</span><span class="p">:</span> <span class="c"># not specfied what to change</span>
        <span class="k">return</span> <span class="n">fleurinp_tree_copy</span>

    <span class="k">if</span> <span class="n">position</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">position</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">xpathatmgroup</span> <span class="o">=</span><span class="s">&#39;/fleurInput/atomGroups/atomGroup/[/*Pos = {}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="n">xpathforce</span> <span class="o">=</span> <span class="s">&#39;{}/force&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathatmgroup</span><span class="p">)</span>
            <span class="n">xpathnocoParams</span> <span class="o">=</span> <span class="s">&#39;{}/nocoParams&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathatmgroup</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">species</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">species</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">xpathatmgroup</span> <span class="o">=</span><span class="s">&#39;/fleurInput/atomGroups/atomGroup[@species = {}]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
            <span class="n">xpathforce</span> <span class="o">=</span> <span class="s">&#39;{}/force&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathatmgroup</span><span class="p">)</span>
            <span class="n">xpathnocoParams</span> <span class="o">=</span> <span class="s">&#39;{}/nocoParams&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpathatmgroup</span><span class="p">)</span>


    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attributedict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;force&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">xml_set_attribv_occ</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathforce</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;nocoParams&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">xml_set_attribv_occ</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathnocoParams</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xml_set_all_attribv</span><span class="p">(</span><span class="n">fleurinp_tree_copy</span><span class="p">,</span> <span class="n">xpathatmgroup</span><span class="p">,</span> <span class="n">attrib</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>



    <span class="k">return</span> <span class="n">fleurinp_tree_copy</span>



<span class="c">####### XML GETTERS #########</span>
<div class="viewcode-block" id="eval_xpath"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.eval_xpath">[docs]</a><span class="k">def</span> <span class="nf">eval_xpath</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">xpath</span><span class="p">,</span> <span class="n">parser_info</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;parser_warnings&#39;</span><span class="p">:[]}):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tries to evalutate an xpath expression. If it fails it logs it.</span>
<span class="sd">    </span>
<span class="sd">    :param root node of an etree and an xpath expression (relative, or absolute)</span>
<span class="sd">    :returns either nodes, or attributes, or text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">xpath</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">etree</span><span class="o">.</span><span class="n">XPathEvalError</span><span class="p">:</span>
        <span class="n">parser_info</span><span class="p">[</span><span class="s">&#39;parser_warnings&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;There was a XpathEvalError on the xpath: {} </span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;Either it does not exist, or something is wrong with the expression.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpath</span><span class="p">))</span>
        <span class="c"># TODO maybe raise an error again to catch in upper routine, to know where exactly</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">return_value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">return_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">return_value</span>

</div>
<div class="viewcode-block" id="eval_xpath2"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.eval_xpath2">[docs]</a><span class="k">def</span> <span class="nf">eval_xpath2</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">xpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tries to evalutate an xpath expression. If it fails it logs it.</span>

<span class="sd">    :param root node of an etree and an xpath expression (relative, or absolute)</span>
<span class="sd">    :returns ALWAYS a node list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">xpath</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">etree</span><span class="o">.</span><span class="n">XPathEvalError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span>
            <span class="s">&#39;There was a XpathEvalError on the xpath: {} </span><span class="se">\n</span><span class="s"> Either it does &#39;</span>
            <span class="s">&#39;not exist, or something is wrong with the expression.&#39;</span>
            <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpath</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">return_value</span>
</div>
<div class="viewcode-block" id="eval_xpath3"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.eval_xpath3">[docs]</a><span class="k">def</span> <span class="nf">eval_xpath3</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">xpath</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">place_index</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tag_order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tries to evalutate an xpath expression. If it fails it logs it.</span>

<span class="sd">    :param root node of an etree and an xpath expression (relative, or absolute)</span>
<span class="sd">    :returns ALWAYS a node list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#print(&#39;call eval_xpath3&#39;)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">xpath</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">etree</span><span class="o">.</span><span class="n">XPathEvalError</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&#39;There was a XpathEvalError on the xpath: {} </span><span class="se">\n</span><span class="s"> Either it does &#39;</span>
            <span class="s">&#39;not exist, or something is wrong with the expression.&#39;</span>
            <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xpath</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">etree</span><span class="o">.</span><span class="n">XPathEvalError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">return_value</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">if</span> <span class="n">create</span><span class="p">:</span>
            <span class="c">#print node, xpath, create</span>
            <span class="n">x_pieces</span> <span class="o">=</span>  <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">xpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">]</span>
            <span class="c">#x_pieces = xpath.split(&#39;/&#39;)</span>
            <span class="n">xpathn</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="c">#for piece in x_pieces[:-1]:</span>
            <span class="c">#    piece = piece + &#39;/&#39;</span>
            <span class="c">#    xpathn = xpathn + piece</span>
            <span class="c">#print x_pieces</span>
            <span class="k">for</span> <span class="n">piece</span> <span class="ow">in</span> <span class="n">x_pieces</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">xpathn</span> <span class="o">=</span> <span class="n">xpathn</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="o">+</span> <span class="n">piece</span>
            <span class="c">#print &#39;xpathn: {}&#39;.format(xpathn)</span>
            <span class="c">#node_c = eval_xpath3(node, xpathn, create)</span>
            <span class="c"># this is REKURSIV! since create tag calls eval_xpath3</span>
            <span class="n">create_tag</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">xpathn</span><span class="p">,</span> <span class="n">x_pieces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">create</span><span class="o">=</span><span class="n">create</span><span class="p">,</span> <span class="n">place_index</span><span class="o">=</span><span class="n">place_index</span><span class="p">,</span> <span class="n">tag_order</span><span class="o">=</span><span class="n">tag_order</span><span class="p">)</span>
            <span class="n">return_value</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">xpath</span><span class="p">)</span>
            <span class="c">#print &#39;return:{}&#39;.format(return_value)</span>
            <span class="k">return</span> <span class="n">return_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">return_value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">return_value</span>

</div>
<div class="viewcode-block" id="get_xml_attribute"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.get_xml_attribute">[docs]</a><span class="k">def</span> <span class="nf">get_xml_attribute</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">attributename</span><span class="p">,</span> <span class="n">parser_info_out</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get an attribute value from a node.</span>

<span class="sd">    :param node: a node from etree</span>
<span class="sd">    :param attributename: a string with the attribute name.</span>
<span class="sd">    :returns either attributevalue, or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">etree</span><span class="o">.</span><span class="n">iselement</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="n">attrib_value</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attributename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrib_value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">attrib_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parser_info_out</span><span class="p">:</span>
                <span class="n">parser_info_out</span><span class="p">[</span><span class="s">&#39;parser_warnings&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s">&#39;Tried to get attribute: &quot;{}&quot; from element {}.</span><span class="se">\n</span><span class="s"> &#39;</span>
                    <span class="s">&#39;I recieved &quot;{}&quot;, maybe the attribute does not exist&#39;</span>
                    <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attributename</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">attrib_value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span>
                    <span class="s">&#39;Can not get attributename: &quot;{}&quot; from node &quot;{}&quot;, &#39;</span>
                    <span class="s">&#39;because node is not an element of etree.&#39;</span>
                    <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attributename</span><span class="p">,</span> <span class="n">node</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span> <span class="c"># something doesn&#39;t work here, some nodes get through here</span>
        <span class="k">if</span> <span class="n">parser_info_out</span><span class="p">:</span>
            <span class="n">parser_info_out</span><span class="p">[</span><span class="s">&#39;parser_warnings&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s">&#39;Can not get attributename: &quot;{}&quot; from node &quot;{}&quot;, &#39;</span>
                <span class="s">&#39;because node is not an element of etree.&#39;</span>
                <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attributename</span><span class="p">,</span> <span class="n">node</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s">&#39;Can not get attributename: &quot;{}&quot; from node &quot;{}&quot;, &#39;</span>
                <span class="s">&#39;because node is not an element of etree.&#39;</span>
                <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attributename</span><span class="p">,</span> <span class="n">node</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">None</span>




<span class="c"># TODO this has to be done better. be able to write tags and</span>
<span class="c"># certain attributes of attributes that occur possible more then once.</span></div>
<div class="viewcode-block" id="write_new_fleur_xmlinp_file"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.write_new_fleur_xmlinp_file">[docs]</a><span class="k">def</span> <span class="nf">write_new_fleur_xmlinp_file</span><span class="p">(</span><span class="n">inp_file_xmltree</span><span class="p">,</span> <span class="n">fleur_change_dic</span><span class="p">,</span> <span class="n">xmlinpstructure</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This modifies the xml-inp file. Makes all the changes wanted by</span>
<span class="sd">    the user or sets some default values for certain modes</span>

<span class="sd">    :param inp_file_lines_o xml-tree of the xml-inp file</span>
<span class="sd">    :param fleur_change_dic dictionary {attrib_name : value} with all the</span>
<span class="sd">           wanted changes.</span>

<span class="sd">    return an etree of the xml-inp file with changes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># TODO rename, name is misleaded just changes the tree.</span>
    <span class="n">xmltree_new</span> <span class="o">=</span> <span class="n">inp_file_xmltree</span>

    <span class="c">#get all attributes of a inpxml file</span>
    <span class="c">#xmlinpstructure = get_inpxml_file_structure()</span>

    <span class="n">pos_switch_once</span> <span class="o">=</span> <span class="n">xmlinpstructure</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pos_switch_several</span> <span class="o">=</span> <span class="n">xmlinpstructure</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pos_attrib_once</span> <span class="o">=</span> <span class="n">xmlinpstructure</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="c">#pos_int_attributes_once = xmlinpstructure[3]</span>
    <span class="c">#pos_float_attributes_once = xmlinpstructure[4]</span>
    <span class="c">#pos_string_attributes_once = xmlinpstructure[5]</span>
    <span class="n">pos_attrib_several</span> <span class="o">=</span> <span class="n">xmlinpstructure</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">pos_int_attributes_several</span> <span class="o">=</span> <span class="n">xmlinpstructure</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
    <span class="c">#pos_float_attributes_several = xmlinpstructure[8]</span>
    <span class="c">#pos_string_attributes_several = xmlinpstructure[9]</span>
    <span class="c">#pos_tags_several = xmlinpstructure[10]</span>
    <span class="n">pos_text</span> <span class="o">=</span> <span class="n">xmlinpstructure</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
    <span class="n">pos_xpaths</span> <span class="o">=</span> <span class="n">xmlinpstructure</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
    <span class="n">expertkey</span> <span class="o">=</span> <span class="n">xmlinpstructure</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>


    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">fleur_change_dic</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pos_switch_once</span><span class="p">:</span>
            <span class="c"># call routine set (key,value) in tree.</span>
            <span class="c"># TODO: a test here if path is plausible and if exist</span>
            <span class="c"># ggf. create tags and key.value is &#39;T&#39; or &#39;F&#39; if not convert,</span>
            <span class="c"># if garbage, exception</span>
            <span class="c"># convert user input into &#39;fleurbool&#39;</span>
            <span class="n">fleur_bool</span> <span class="o">=</span> <span class="n">convert_to_fortran_bool</span><span class="p">(</span><span class="n">fleur_change_dic</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

            <span class="n">xpath_set</span> <span class="o">=</span> <span class="n">pos_xpaths</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="c">#TODO: check if something in setup is inconsitent?</span>

            <span class="c"># apply change to tree</span>
            <span class="c">#print xmltree_new, xpath_set, key, fleur_bool</span>
            <span class="n">xml_set_first_attribv</span><span class="p">(</span><span class="n">xmltree_new</span><span class="p">,</span> <span class="n">xpath_set</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">fleur_bool</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pos_attrib_once</span><span class="p">:</span>
            <span class="c"># TODO: same here, check existance and plausiblility of xpath</span>
            <span class="n">xpath_set</span> <span class="o">=</span> <span class="n">pos_xpaths</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="c">#print xmltree_new, xpath_set, key, fleur_change_dic[key]</span>
            <span class="n">xml_set_first_attribv</span><span class="p">(</span><span class="n">xmltree_new</span><span class="p">,</span> <span class="n">xpath_set</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">fleur_change_dic</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pos_attrib_several</span><span class="p">:</span>
            <span class="c"># TODO What attribute shall be set? all, one or several specific onces?</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pos_switch_several</span><span class="p">:</span>
            <span class="c"># TODO</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pos_text</span><span class="p">:</span>
            <span class="c"># can be several times, therefore check</span>
            <span class="n">xpath_set</span> <span class="o">=</span> <span class="n">pos_xpaths</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">xml_set_text</span><span class="p">(</span><span class="n">xmltree_new</span><span class="p">,</span> <span class="n">xpath_set</span><span class="p">,</span> <span class="n">fleur_change_dic</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">expertkey</span><span class="p">:</span>
            <span class="c"># posibility for experts to set something, not suported by the plug-in directly</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># this key is not know to plug-in</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                <span class="s">&quot;You try to set the key:&#39;{}&#39; to : &#39;{}&#39;, but the key is unknown&quot;</span>
                <span class="s">&quot; to the fleur plug-in&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">fleur_change_dic</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">xmltree_new</span>
</div>
<div class="viewcode-block" id="inpxml_todict"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.inpxml_todict">[docs]</a><span class="k">def</span> <span class="nf">inpxml_todict</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">xmlstr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recursive operation which transforms an xml etree to</span>
<span class="sd">    python dictionaries and lists.</span>
<span class="sd">    Decision to add a list is if the tag name is in the given list tag_several</span>

<span class="sd">    :param parent: some xmltree, or xml element</span>
<span class="sd">    :param xmlstr: structure/layout of the xml file in xmlstr is tags_several:</span>
<span class="sd">                   a list of the tags, which should be converted to a list, not</span>
<span class="sd">                   a dictionary(because they are known to occur more often, and</span>
<span class="sd">                   want to be accessed in a list later.</span>

<span class="sd">    :return: a python dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">xmlstructure</span> <span class="o">=</span> <span class="n">xmlstr</span>
    <span class="n">pos_switch_once1</span> <span class="o">=</span> <span class="n">xmlstructure</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pos_switch_several1</span> <span class="o">=</span> <span class="n">xmlstructure</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c">#pos_attrib_once1 = xmlstructure[2]</span>
    <span class="n">int_attributes_once1</span> <span class="o">=</span> <span class="n">xmlstructure</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">float_attributes_once1</span> <span class="o">=</span> <span class="n">xmlstructure</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">string_attributes_once1</span> <span class="o">=</span> <span class="n">xmlstructure</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="c">#pos_attrib_several1 = xmlstructure[6]</span>
    <span class="n">int_attributes_several1</span> <span class="o">=</span> <span class="n">xmlstructure</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">float_attributes_several1</span> <span class="o">=</span> <span class="n">xmlstructure</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
    <span class="n">string_attributes_several1</span> <span class="o">=</span> <span class="n">xmlstructure</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
    <span class="n">tags_several1</span> <span class="o">=</span> <span class="n">xmlstructure</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
    <span class="n">pos_text1</span> <span class="o">=</span> <span class="n">xmlstructure</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
    <span class="c">#pos_xpaths1 = xmlstructure[12]</span>
    <span class="c">#expertkey1 = xmlstructure[13]</span>

    <span class="n">return_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">return_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="c"># Now we have to convert lazy fortan style into pretty things for the Database</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">return_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pos_switch_once1</span> <span class="ow">or</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">pos_switch_several1</span><span class="p">):</span>
                <span class="n">return_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_from_fortran_bool</span><span class="p">(</span><span class="n">return_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">int_attributes_once1</span> <span class="ow">or</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">int_attributes_several1</span><span class="p">):</span>
                <span class="c"># TODO int several</span>
                <span class="n">return_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">return_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">string_attributes_once1</span> <span class="ow">or</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">string_attributes_several1</span><span class="p">):</span>
                <span class="c"># TODO What attribute shall be set? all, one or several specific onces?</span>
                <span class="n">return_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">return_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">float_attributes_once1</span> <span class="ow">or</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">float_attributes_several1</span><span class="p">):</span>
                <span class="c"># TODO pressision?</span>
                <span class="n">return_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">return_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="c">#pass</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pos_text1</span><span class="p">:</span>
                <span class="c"># TODO, prob not nessesary, since taken care of below check,</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
                <span class="c"># this key is not know to plug-in TODO maybe make this a method</span>
                <span class="c"># of the parser and log this as warning, or add here make a log</span>
                <span class="c"># list, to which you always append messages, pass them back to</span>
                <span class="c"># the parser, who locks it then</span>
                <span class="c"># raise TypeError(&quot;Parser wanted to convert the key:&#39;{}&#39; with</span>
                <span class="c"># value &#39;{}&#39;, from the inpxml file but the key is unknown to the</span>
                <span class="c"># fleur plug-in&quot;.format(key, return_dict[key]))</span>


    <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="c"># TODO more detal, exp: relPos</span>
        <span class="c"># has text, but we don&#39;t want all the &#39;\n&#39; s and empty stings in the database</span>
        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span> <span class="c"># might not be the best solution</span>
            <span class="c"># set text</span>
            <span class="n">return_dict</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">firstocc</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">parent</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">tags_several1</span><span class="p">:</span>
            <span class="c">#make a list, otherwise the tag will be overwritten in the dict</span>
            <span class="k">if</span> <span class="n">firstocc</span><span class="p">:</span> <span class="c"># is this the first occurence?</span>
                <span class="c">#create a list</span>
                <span class="n">return_dict</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">return_dict</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inpxml_todict</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">xmlstructure</span><span class="p">))</span>
                <span class="n">firstocc</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span> <span class="c"># occured before, a list already exists, therefore just add</span>
                <span class="n">return_dict</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inpxml_todict</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">xmlstructure</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#make dict</span>
            <span class="n">return_dict</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpxml_todict</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">xmlstructure</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">return_dict</span>



<span class="c"># TODO this should be replaced by something else, maybe a class. that has a method to return certain</span>
<span class="c"># list of possible xpaths from a schema file, or to validate a certain xpath expression and</span>
<span class="c"># to allow to get SINGLE xpaths for certain attrbiutes.</span>
<span class="c">#  akk: tell me where &#39;DOS&#39; is</span></div>
<div class="viewcode-block" id="get_inpxml_file_structure"><a class="viewcode-back" href="../../../../../code.html#aiida.tools.codespecific.fleur.xml_util.get_inpxml_file_structure">[docs]</a><span class="k">def</span> <span class="nf">get_inpxml_file_structure</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This routine returns the structure/layout of the &#39;inp.xml&#39; file.</span>

<span class="sd">    Basicly the plug-in should know from this routine, what things are allowed</span>
<span class="sd">    to be set and where, i.e all attributes and their xpaths.</span>
<span class="sd">    As a developer make sure to use this routine always of you need information</span>
<span class="sd">    about the inp.xml file structure.</span>
<span class="sd">    Therefore, this plug-in should be easy to adjust to other codes with xml </span>
<span class="sd">    files as input files. Just rewrite this routine.</span>

<span class="sd">    For now the structure of the xmlinp file for fleur is hardcoded.</span>
<span class="sd">    If big changes are in the &#39;inp.xml&#39; file, maintain this routine.</span>
<span class="sd">    TODO: Maybe this is better done, by reading the xml schema datei instead.</span>
<span class="sd">    And maybe it should also work without the schema file, do we want this?</span>

<span class="sd">    :param Nothing: TODO xml schema</span>

<span class="sd">    :return all_switches_once: list of all switches (&#39;T&#39; or &#39;F&#39;) which are allowed to be set</span>
<span class="sd">    :return all_switches_several: list of all switches (&#39;T&#39; or &#39;F&#39;) which are allowed to be set</span>
<span class="sd">    :return other_attributes_once: list of all attributes, which occur just once (can be tested)</span>
<span class="sd">    :return other_attributes_several: list of all attributes, which can occur more then once</span>
<span class="sd">    :return all_text: list of all text of tags, which can be set</span>
<span class="sd">    :return all_attrib_xpath: dictonary (attrib, xpath), of all possible attributes</span>
<span class="sd">                              with their xpath expression for the xmp inp</span>
<span class="sd">    :return expertkey: keyname (should not be in any other list), which can be</span>
<span class="sd">                       used to set anything in the file, by hand,</span>
<span class="sd">     (for experts, and that plug-in does not need to be directly maintained if</span>
<span class="sd">     xmlinp gets a new switch)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># All attributes (allowed to change?)</span>

    <span class="c">#switches can be &#39;T&#39; ot &#39;F&#39; # TODO: alphabetical sorting</span>
    <span class="n">all_switches_once</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&#39;dos&#39;</span><span class="p">,</span> <span class="s">&#39;band&#39;</span><span class="p">,</span> <span class="s">&#39;secvar&#39;</span><span class="p">,</span> <span class="s">&#39;ctail&#39;</span><span class="p">,</span> <span class="s">&#39;frcor&#39;</span><span class="p">,</span> <span class="s">&#39;l_noco&#39;</span><span class="p">,</span>
        <span class="s">&#39;ctail&#39;</span><span class="p">,</span> <span class="s">&#39;swsp&#39;</span><span class="p">,</span> <span class="s">&#39;lflip&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">,</span> <span class="s">&#39;spav&#39;</span><span class="p">,</span> <span class="s">&#39;l_soc&#39;</span><span class="p">,</span> <span class="s">&#39;soc66&#39;</span><span class="p">,</span> <span class="s">&#39;pot8&#39;</span><span class="p">,</span>
        <span class="s">&#39;eig66&#39;</span><span class="p">,</span> <span class="s">&#39;gamma&#39;</span><span class="p">,</span> <span class="s">&#39;gauss&#39;</span><span class="p">,</span> <span class="s">&#39;tria&#39;</span><span class="p">,</span> <span class="s">&#39;invs&#39;</span><span class="p">,</span> <span class="s">&#39;invs2&#39;</span><span class="p">,</span> <span class="s">&#39;zrfs&#39;</span><span class="p">,</span> <span class="s">&#39;vchk&#39;</span><span class="p">,</span> <span class="s">&#39;cdinf&#39;</span><span class="p">,</span>
        <span class="s">&#39;disp&#39;</span><span class="p">,</span> <span class="s">&#39;vacdos&#39;</span><span class="p">,</span> <span class="s">&#39;integ&#39;</span><span class="p">,</span> <span class="s">&#39;star&#39;</span><span class="p">,</span> <span class="s">&#39;iplot&#39;</span><span class="p">,</span> <span class="s">&#39;score&#39;</span><span class="p">,</span> <span class="s">&#39;plplot&#39;</span><span class="p">,</span> <span class="s">&#39;slice&#39;</span><span class="p">,</span>
        <span class="s">&#39;pallst&#39;</span><span class="p">,</span> <span class="s">&#39;form66&#39;</span><span class="p">,</span> <span class="s">&#39;eonly&#39;</span><span class="p">,</span> <span class="s">&#39;bmt&#39;</span><span class="p">,</span> <span class="s">&#39;relativisticCorrections&#39;</span><span class="p">,</span> <span class="s">&#39;l_J&#39;</span><span class="p">,</span> <span class="s">&#39;l_f&#39;</span><span class="p">)</span>

    <span class="n">all_switches_several</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;calculate&#39;</span><span class="p">,</span> <span class="s">&#39;flipSpin&#39;</span><span class="p">)</span>

    <span class="n">int_attributes_once</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;numbands&#39;</span><span class="p">,</span> <span class="s">&#39;itmax&#39;</span><span class="p">,</span> <span class="s">&#39;maxIterBroyd&#39;</span><span class="p">,</span> <span class="s">&#39;kcrel&#39;</span><span class="p">,</span> <span class="s">&#39;jspins&#39;</span><span class="p">,</span>
                           <span class="s">&#39;gw&#39;</span><span class="p">,</span> <span class="s">&#39;isec1&#39;</span><span class="p">,</span> <span class="s">&#39;nx&#39;</span><span class="p">,</span> <span class="s">&#39;ny&#39;</span><span class="p">,</span> <span class="s">&#39;nz&#39;</span><span class="p">,</span> <span class="s">&#39;ndir&#39;</span><span class="p">,</span> <span class="s">&#39;layers&#39;</span><span class="p">,</span>
                           <span class="s">&#39;nstars&#39;</span><span class="p">,</span> <span class="s">&#39;nstm&#39;</span><span class="p">,</span> <span class="s">&#39;numkpt&#39;</span><span class="p">,</span> <span class="s">&#39;nnne&#39;</span><span class="p">,</span> <span class="s">&#39;lpr&#39;</span><span class="p">,</span> <span class="s">&#39;count&#39;</span><span class="p">)</span>
    <span class="n">float_attributes_once</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Kmax&#39;</span><span class="p">,</span> <span class="s">&#39;Gmax&#39;</span><span class="p">,</span> <span class="s">&#39;GmaxXC&#39;</span><span class="p">,</span> <span class="s">&#39;alpha&#39;</span><span class="p">,</span> <span class="s">&#39;spinf&#39;</span><span class="p">,</span> <span class="s">&#39;theta&#39;</span><span class="p">,</span>
                             <span class="s">&#39;phi&#39;</span><span class="p">,</span> <span class="s">&#39;xa&#39;</span><span class="p">,</span> <span class="s">&#39;thetad&#39;</span><span class="p">,</span> <span class="s">&#39;epsdisp&#39;</span><span class="p">,</span> <span class="s">&#39;epsforce&#39;</span><span class="p">,</span>
                             <span class="s">&#39;valenceElectrons&#39;</span><span class="p">,</span> <span class="s">&#39;fermiSmearingEnergy&#39;</span><span class="p">,</span> <span class="s">&#39;ellow&#39;</span><span class="p">,</span>
                             <span class="s">&#39;elup&#39;</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">,</span> <span class="s">&#39;dTilda&#39;</span><span class="p">,</span> <span class="s">&#39;dVac&#39;</span><span class="p">,</span> <span class="s">&#39;minEnergy&#39;</span><span class="p">,</span>
                             <span class="s">&#39;maxEnergy&#39;</span><span class="p">,</span> <span class="s">&#39;sigma&#39;</span><span class="p">,</span> <span class="s">&#39;locx1&#39;</span><span class="p">,</span> <span class="s">&#39;locy1&#39;</span><span class="p">,</span> <span class="s">&#39;locx2&#39;</span><span class="p">,</span>
                             <span class="s">&#39;locy2&#39;</span><span class="p">,</span> <span class="s">&#39;tworkf&#39;</span><span class="p">,</span> <span class="s">&#39;minEigenval&#39;</span><span class="p">,</span> <span class="s">&#39;maxEigenval&#39;</span><span class="p">)</span>
    <span class="n">string_attributes_once</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;imix&#39;</span><span class="p">,</span> <span class="s">&#39;mode&#39;</span><span class="p">,</span> <span class="s">&#39;filename&#39;</span><span class="p">,</span> <span class="s">&#39;latnam&#39;</span><span class="p">,</span> <span class="s">&#39;spgrp&#39;</span><span class="p">,</span>
                              <span class="s">&#39;xcFunctional&#39;</span><span class="p">,</span> <span class="s">&#39;fleurInputVersion&#39;</span><span class="p">,</span> <span class="s">&#39;species&#39;</span><span class="p">)</span>



    <span class="n">other_attributes_once</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">int_attributes_once</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">float_attributes_once</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">string_attributes_once</span><span class="p">))</span>
    <span class="c">#print other_attributes_once</span>
    <span class="n">other_attributes_once1</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&#39;isec1&#39;</span><span class="p">,</span> <span class="s">&#39;Kmax&#39;</span><span class="p">,</span> <span class="s">&#39;Gmax&#39;</span><span class="p">,</span> <span class="s">&#39;GmaxXC&#39;</span><span class="p">,</span> <span class="s">&#39;numbands&#39;</span><span class="p">,</span> <span class="s">&#39;itmax&#39;</span><span class="p">,</span> <span class="s">&#39;maxIterBroyd&#39;</span><span class="p">,</span>
        <span class="s">&#39;imix&#39;</span><span class="p">,</span> <span class="s">&#39;alpha&#39;</span><span class="p">,</span> <span class="s">&#39;spinf&#39;</span><span class="p">,</span> <span class="s">&#39;kcrel&#39;</span><span class="p">,</span> <span class="s">&#39;jspins&#39;</span><span class="p">,</span> <span class="s">&#39;theta&#39;</span><span class="p">,</span> <span class="s">&#39;phi&#39;</span><span class="p">,</span> <span class="s">&#39;gw&#39;</span><span class="p">,</span> <span class="s">&#39;lpr&#39;</span><span class="p">,</span>
        <span class="s">&#39;xa&#39;</span><span class="p">,</span> <span class="s">&#39;thetad&#39;</span><span class="p">,</span> <span class="s">&#39;epsdisp&#39;</span><span class="p">,</span> <span class="s">&#39;epsforce&#39;</span><span class="p">,</span> <span class="s">&#39;valenceElectrons&#39;</span><span class="p">,</span> <span class="s">&#39;mode&#39;</span><span class="p">,</span>
        <span class="s">&#39;gauss&#39;</span><span class="p">,</span> <span class="s">&#39;fermiSmearingEnergy&#39;</span><span class="p">,</span> <span class="s">&#39;nx&#39;</span><span class="p">,</span> <span class="s">&#39;ny&#39;</span><span class="p">,</span> <span class="s">&#39;nz&#39;</span><span class="p">,</span> <span class="s">&#39;ellow&#39;</span><span class="p">,</span> <span class="s">&#39;elup&#39;</span><span class="p">,</span>
        <span class="s">&#39;filename&#39;</span><span class="p">,</span> <span class="s">&#39;scale&#39;</span><span class="p">,</span> <span class="s">&#39;dTilda&#39;</span><span class="p">,</span> <span class="s">&#39;dVac&#39;</span><span class="p">,</span> <span class="s">&#39;ndir&#39;</span><span class="p">,</span> <span class="s">&#39;minEnergy&#39;</span><span class="p">,</span> <span class="s">&#39;maxEnergy&#39;</span><span class="p">,</span>
        <span class="s">&#39;sigma&#39;</span><span class="p">,</span> <span class="s">&#39;layers&#39;</span><span class="p">,</span> <span class="s">&#39;nstars&#39;</span><span class="p">,</span> <span class="s">&#39;locx1&#39;</span><span class="p">,</span> <span class="s">&#39;locy1&#39;</span><span class="p">,</span> <span class="s">&#39;locx2&#39;</span><span class="p">,</span> <span class="s">&#39;locy2&#39;</span><span class="p">,</span> <span class="s">&#39;nstm&#39;</span><span class="p">,</span>
        <span class="s">&#39;tworkf&#39;</span><span class="p">,</span> <span class="s">&#39;numkpt&#39;</span><span class="p">,</span> <span class="s">&#39;minEigenval&#39;</span><span class="p">,</span> <span class="s">&#39;maxEigenval&#39;</span><span class="p">,</span> <span class="s">&#39;nnne&#39;</span><span class="p">)</span>


    <span class="n">int_attributes_several</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;atomicNumber&#39;</span><span class="p">,</span> <span class="s">&#39;gridPoints&#39;</span><span class="p">,</span> <span class="s">&#39;lmax&#39;</span><span class="p">,</span> <span class="s">&#39;lnonsphr&#39;</span><span class="p">,</span>
                              <span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="s">&#39;p&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="s">&#39;l&#39;</span><span class="p">,</span> <span class="s">&#39;n&#39;</span><span class="p">,</span> <span class="s">&#39;eDeriv&#39;</span><span class="p">,</span> <span class="s">&#39;coreStates&#39;</span><span class="p">)</span>
    <span class="n">float_attributes_several</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="s">&#39;magMom&#39;</span><span class="p">,</span> <span class="s">&#39;radius&#39;</span><span class="p">,</span> <span class="s">&#39;logIncrement&#39;</span><span class="p">)</span>
    <span class="n">string_attributes_several</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;element&#39;</span><span class="p">,</span> <span class="s">&#39;coreStates&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;relaxXYZ&#39;</span><span class="p">)</span>
    <span class="n">other_attributes_several</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="s">&#39;element&#39;</span><span class="p">,</span> <span class="s">&#39;atomicNumber&#39;</span><span class="p">,</span> <span class="s">&#39;coreStates&#39;</span><span class="p">,</span> <span class="s">&#39;magMom&#39;</span><span class="p">,</span>
        <span class="s">&#39;radius&#39;</span><span class="p">,</span> <span class="s">&#39;gridPoints&#39;</span><span class="p">,</span> <span class="s">&#39;logIncrement&#39;</span><span class="p">,</span> <span class="s">&#39;lmax&#39;</span><span class="p">,</span> <span class="s">&#39;lnonsphr&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="s">&#39;p&#39;</span><span class="p">,</span>
        <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="s">&#39;species&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;coreStates&#39;</span><span class="p">,</span> <span class="s">&#39;l&#39;</span><span class="p">,</span> <span class="s">&#39;n&#39;</span><span class="p">,</span> <span class="s">&#39;eDeriv&#39;</span><span class="p">,</span> <span class="s">&#39;relaxXYZ&#39;</span><span class="p">)</span>

    <span class="c"># when parsing the xml file to a dict, these tags should become</span>
    <span class="c"># list(sets, or tuples) instead of dictionaries.</span>
    <span class="n">tags_several</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;atomGroup&#39;</span><span class="p">,</span> <span class="s">&#39;relPos&#39;</span><span class="p">,</span> <span class="s">&#39;absPos&#39;</span><span class="p">,</span> <span class="s">&#39;filmPos&#39;</span><span class="p">,</span> <span class="s">&#39;species&#39;</span><span class="p">,</span> <span class="s">&#39;kPoint&#39;</span><span class="p">)</span>

    <span class="n">all_text</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;comment&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;relPos&#39;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;filmPos&#39;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;absPos&#39;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s">&#39;row-1&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;row-2&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;row-3&#39;</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;a1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="c">#TODO all these (without comment) are floats, or float tuples.</span>
    <span class="c">#Should be converted to this in the databas</span>
    <span class="c"># changing the Bravais matrix should rather not be allowed I guess</span>

    <span class="c"># all attribute xpaths</span>

    <span class="c">#text xpaths(coordinates, bravaisMatrix)</span>
    <span class="c">#all switches once, several, all attributes once, several</span>
    <span class="n">all_attrib_xpath</span> <span class="o">=</span> <span class="p">{</span><span class="c"># text</span>
        <span class="s">&#39;comment&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/comment&#39;</span><span class="p">,</span>
        <span class="s">&#39;relPos&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomGroups/atomGroup/relPos&#39;</span><span class="p">,</span>
        <span class="s">&#39;filmPos&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomGroups/atomGroup/filmPos&#39;</span><span class="p">,</span>
        <span class="s">&#39;absPos&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomGroups/atomGroup/absPos&#39;</span><span class="p">,</span>
        <span class="s">&#39;row-1&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/cell/bulkLattice/bravaisMatrix&#39;</span><span class="p">,</span>
        <span class="s">&#39;row-2&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/cell/bulkLattice/bravaisMatrix&#39;</span><span class="p">,</span>
        <span class="s">&#39;row-3&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/cell/bulkLattice/bravaisMatrix&#39;</span><span class="p">,</span>
        <span class="s">&#39;a1&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/cell/filmLattice/a1&#39;</span><span class="p">,</span> <span class="c">#switches once</span>
        <span class="s">&#39;dos&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output&#39;</span><span class="p">,</span>
        <span class="s">&#39;band&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output&#39;</span><span class="p">,</span>
        <span class="s">&#39;secvar&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/expertModes&#39;</span><span class="p">,</span>
        <span class="s">&#39;ctail&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/coreElectrons&#39;</span><span class="p">,</span>
        <span class="s">&#39;frcor&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/coreElectrons&#39;</span><span class="p">,</span>
        <span class="s">&#39;l_noco&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/magnetism&#39;</span><span class="p">,</span>
        <span class="s">&#39;l_J&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/magnetism&#39;</span><span class="p">,</span>
        <span class="s">&#39;swsp&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/magnetism&#39;</span><span class="p">,</span>
        <span class="s">&#39;lflip&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/magnetism&#39;</span><span class="p">,</span>
        <span class="s">&#39;off&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/soc&#39;</span><span class="p">,</span>
        <span class="s">&#39;spav&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/soc&#39;</span><span class="p">,</span>
        <span class="s">&#39;l_soc&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/soc&#39;</span><span class="p">,</span>
        <span class="s">&#39;soc66&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/soc&#39;</span><span class="p">,</span>
        <span class="s">&#39;pot8&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/expertModes&#39;</span><span class="p">,</span>
        <span class="s">&#39;eig66&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/expertModes&#39;</span><span class="p">,</span>
        <span class="s">&#39;l_f&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/geometryOptimization&#39;</span><span class="p">,</span>
        <span class="s">&#39;gamma&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/bzIntegration/kPointMesh&#39;</span><span class="p">,</span>
        <span class="s">&#39;gauss&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;tria&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;invs&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;zrfs&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="s">&#39;vchk&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/checks&#39;</span><span class="p">,</span>
        <span class="s">&#39;cdinf&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/checks&#39;</span><span class="p">,</span>
        <span class="s">&#39;disp&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/checks&#39;</span><span class="p">,</span>
        <span class="s">&#39;vacdos&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output&#39;</span><span class="p">,</span>
        <span class="s">&#39;integ&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
        <span class="s">&#39;star&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
        <span class="s">&#39;iplot&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/plotting&#39;</span><span class="p">,</span>
        <span class="s">&#39;score&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/plotting&#39;</span><span class="p">,</span>
        <span class="s">&#39;plplot&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/plotting&#39;</span><span class="p">,</span>
        <span class="s">&#39;slice&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output&#39;</span><span class="p">,</span>
        <span class="s">&#39;pallst&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/chargeDensitySlicing&#39;</span><span class="p">,</span>
        <span class="s">&#39;form66&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/specialOutput&#39;</span><span class="p">,</span>
        <span class="s">&#39;eonly&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/specialOutput&#39;</span><span class="p">,</span>
        <span class="s">&#39;bmt&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/specialOutput&#39;</span><span class="p">,</span>
        <span class="s">&#39;relativisticCorrections&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/xcFunctional&#39;</span><span class="p">,</span> <span class="c">#ALL_Switches_several</span>
        <span class="s">&#39;calculate&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomGroups/atomGroup/force&#39;</span><span class="p">,</span>
        <span class="s">&#39;flipSpin&#39;</span> <span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species&#39;</span><span class="p">,</span> <span class="c">#other_attributes_once</span>
        <span class="s">&#39;Kmax&#39;</span> <span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/cutoffs&#39;</span><span class="p">,</span>
        <span class="s">&#39;Gmax&#39;</span> <span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/cutoffs&#39;</span><span class="p">,</span>
        <span class="s">&#39;GmaxXC&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/cutoffs&#39;</span><span class="p">,</span>
        <span class="s">&#39;numbands&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/cutoffs&#39;</span><span class="p">,</span>
        <span class="s">&#39;itmax&#39;</span> <span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/scfLoop&#39;</span><span class="p">,</span>
        <span class="s">&#39;maxIterBroyd&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/scfLoop&#39;</span><span class="p">,</span>
        <span class="s">&#39;imix&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/scfLoop&#39;</span><span class="p">,</span>
        <span class="s">&#39;alpha&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/scfLoop&#39;</span><span class="p">,</span>
        <span class="s">&#39;spinf&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/scfLoop&#39;</span><span class="p">,</span>
        <span class="s">&#39;kcrel&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/coreElectrons&#39;</span><span class="p">,</span>
        <span class="s">&#39;jspins&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/magnetism&#39;</span><span class="p">,</span>
        <span class="s">&#39;theta&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/soc&#39;</span><span class="p">,</span>
        <span class="s">&#39;phi&#39;</span> <span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/soc&#39;</span><span class="p">,</span>
        <span class="s">&#39;gw&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/expertModes&#39;</span><span class="p">,</span>
        <span class="s">&#39;lpr&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/expertModes&#39;</span><span class="p">,</span>
        <span class="s">&#39;isec1&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/expertModes&#39;</span><span class="p">,</span>
        <span class="s">&#39;xa&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/geometryOptimization&#39;</span><span class="p">,</span>
        <span class="s">&#39;thetad&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/geometryOptimization&#39;</span><span class="p">,</span>
        <span class="s">&#39;epsdisp&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/geometryOptimization&#39;</span><span class="p">,</span>
        <span class="s">&#39;epsforce&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/geometryOptimization&#39;</span><span class="p">,</span>
        <span class="s">&#39;valenceElectrons&#39;</span><span class="p">:</span><span class="s">&#39;/fleurInput/calculationSetup/bzIntegration&#39;</span><span class="p">,</span>
        <span class="s">&#39;mode&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/bzIntegration&#39;</span><span class="p">,</span>
        <span class="s">&#39;fermiSmearingEnergy&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/bzIntegration&#39;</span><span class="p">,</span>
        <span class="s">&#39;nx&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/bzIntegration/kPointMesh&#39;</span><span class="p">,</span>
        <span class="s">&#39;ny&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/bzIntegration/kPointMesh&#39;</span><span class="p">,</span>
        <span class="s">&#39;nz&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/bzIntegration/kPointMesh&#39;</span><span class="p">,</span>
        <span class="s">&#39;count&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/kPointCount&#39;</span><span class="p">,</span>
        <span class="s">&#39;ellow&#39;</span> <span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup/energyParameterLimits&#39;</span><span class="p">,</span>
        <span class="s">&#39;elup&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/calculationSetup&#39;</span><span class="p">,</span>
        <span class="s">&#39;filename&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/cell/symmetryFile&#39;</span><span class="p">,</span>
        <span class="s">&#39;scale&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/cell/bulkLattice&#39;</span><span class="p">,</span>
        <span class="s">&#39;ndir&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/densityOfStates&#39;</span><span class="p">,</span>
        <span class="s">&#39;minEnergy&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/densityOfStates&#39;</span><span class="p">,</span>
        <span class="s">&#39;maxEnergy&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/densityOfStates&#39;</span><span class="p">,</span>
        <span class="s">&#39;sigma&#39;</span><span class="p">:</span><span class="s">&#39; /fleurInput/output/densityOfStates&#39;</span><span class="p">,</span>
        <span class="s">&#39;layers&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
        <span class="s">&#39;nstars&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
        <span class="s">&#39;locx1&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
        <span class="s">&#39;locy1&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
        <span class="s">&#39;locx2&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
        <span class="s">&#39;locy2&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
        <span class="s">&#39;nstm&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
        <span class="s">&#39;tworkf&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
        <span class="s">&#39;numkpts&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/chargeDensitySlicing&#39;</span><span class="p">,</span>
        <span class="s">&#39;minEigenval&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/chargeDensitySlicing&#39;</span><span class="p">,</span>
        <span class="s">&#39;maxEigenval&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/chargeDensitySlicing&#39;</span><span class="p">,</span>
        <span class="s">&#39;nnne&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/output/chargeDensitySlicing&#39;</span><span class="p">,</span>
        <span class="s">&#39;dVac&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/cell/filmLattice&#39;</span><span class="p">,</span>
        <span class="s">&#39;dTilda&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/cell/filmLattice&#39;</span><span class="p">,</span>
        <span class="s">&#39;xcFunctional&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/xcFunctional/@name&#39;</span><span class="p">,</span><span class="c">#other_attributes_more</span>
        <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;/fleurInput/constantDefinitions&#39;</span><span class="p">,</span> <span class="s">&#39;/fleurInput/xcFunctional&#39;</span><span class="p">,</span>
                 <span class="s">&#39;/fleurInput/atomSpecies/species&#39;</span><span class="p">},</span>
        <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/constantDefinitions&#39;</span><span class="p">,</span>
        <span class="s">&#39;element&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species&#39;</span><span class="p">,</span>
        <span class="s">&#39;atomicNumber&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species&#39;</span><span class="p">,</span>
        <span class="s">&#39;coreStates&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species&#39;</span><span class="p">,</span>
        <span class="s">&#39;magMom&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species&#39;</span><span class="p">,</span>
        <span class="s">&#39;radius&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species/mtSphere&#39;</span><span class="p">,</span>
        <span class="s">&#39;gridPoints&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species/mtSphere&#39;</span><span class="p">,</span>
        <span class="s">&#39;logIncrement&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species/mtSphere&#39;</span><span class="p">,</span>
        <span class="s">&#39;lmax&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species/atomicCutoffs&#39;</span><span class="p">,</span>
        <span class="s">&#39;lnonsphr&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species/atomicCutoffs&#39;</span><span class="p">,</span>
        <span class="s">&#39;s&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species/energyParameters&#39;</span><span class="p">,</span>
        <span class="s">&#39;p&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species/energyParameters&#39;</span><span class="p">,</span>
        <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species/energyParameters&#39;</span><span class="p">,</span>
        <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species/energyParameters&#39;</span><span class="p">,</span>
        <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species/lo&#39;</span><span class="p">,</span>
        <span class="s">&#39;l&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species/lo&#39;</span><span class="p">,</span>
        <span class="s">&#39;n&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species/lo&#39;</span><span class="p">,</span>
        <span class="s">&#39;eDeriv&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomSpecies/species/lo&#39;</span><span class="p">,</span>
        <span class="s">&#39;species&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomGroups/atomGroup&#39;</span><span class="p">,</span>
        <span class="s">&#39;relaxXYX&#39;</span><span class="p">:</span> <span class="s">&#39;/fleurInput/atomGroups/atomGroup/force&#39;</span>
    <span class="p">}</span>
    <span class="c">#&#39;constant&#39;: (name, value)</span>
    <span class="c">#&#39;xcFunctional&#39; : name</span>
    <span class="c">#&#39;species&#39; : (old_name, set_name)</span>
    <span class="c">#&#39;radius&#39;: (spcies_name, value), (species_id, value), (species_element, value)</span>
    <span class="c"># all tags paths, make this a dict?</span>

    <span class="n">all_tag_xpaths</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&#39;/fleurInput/constantDefinitions&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/calculationSetup&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/calculationSetup/cutoffs&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/calculationSetup/scfLoop&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/calculationSetup/coreElectrons&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/calculationSetup/magnetism&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/calculationSetup/soc&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/calculationSetup/expertModes&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/calculationSetup/geometryOptimization&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/calculationSetup/bzIntegration&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/calculationSetup/kPointMesh&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/cell/symmetry&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/cell/bravaisMatrix&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/xcFunctional&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/xcFunctional/xcParams&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/atomSpecies/species&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/atomSpecies/species/mtSphere&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/atomSpecies/species/atomicCutoffs&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/atomSpecies/species/energyParameters&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/atomSpecies/species/coreConfig&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/atomSpecies/species/coreOccupation&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/atomGroups/atomGroup&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/atomGroups/atomGroup/relPos&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/atomGroups/atomGroup/absPos&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/atomGroups/atomGroup/filmPos&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/output/checks&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/output/densityOfStates&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/output/vacuumDOS&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/output/plotting&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/output/chargeDensitySlicing&#39;</span><span class="p">,</span>
        <span class="s">&#39;/fleurInput/output/specialOutput&#39;</span>
    <span class="p">)</span>

    <span class="n">expertkey</span> <span class="o">=</span> <span class="s">&#39;other&#39;</span>
    <span class="n">returnlist</span> <span class="o">=</span> <span class="p">(</span><span class="n">all_switches_once</span><span class="p">,</span>
                  <span class="n">all_switches_several</span><span class="p">,</span>
                  <span class="n">other_attributes_once</span><span class="p">,</span>
                  <span class="n">int_attributes_once</span><span class="p">,</span>
                  <span class="n">float_attributes_once</span><span class="p">,</span>
                  <span class="n">string_attributes_once</span><span class="p">,</span>
                  <span class="n">other_attributes_several</span><span class="p">,</span>
                  <span class="n">int_attributes_several</span><span class="p">,</span>
                  <span class="n">float_attributes_several</span><span class="p">,</span>
                  <span class="n">string_attributes_several</span><span class="p">,</span>
                  <span class="n">tags_several</span><span class="p">,</span>
                  <span class="n">all_text</span><span class="p">,</span>
                  <span class="n">all_attrib_xpath</span><span class="p">,</span>
                  <span class="n">expertkey</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">returnlist</span>
</pre></div></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Jens Broeder.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../',
            VERSION:'0.27 beta',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>