

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aiida.orm.calculation.job.fleur_inp.fleurinputgen &mdash; Fleur plugin 0.27 beta documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Fleur plugin 0.27 beta documentation" href="../../../../../../index.html"/>
        <link rel="up" title="Module code" href="../../../../../index.html"/> 

  
  <script src="../../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../../index.html" class="icon icon-home"> Fleur plugin
          

          
          </a>

          
            
            
              <div class="version">
                0.27 beta
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../plugin/fleur_plugin.html">Fleur-plugin</a></li>
</ul>
<ul class="simple">
</ul>
<ul class="simple">
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../code.html">Plug-in Classes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../../../index.html">Fleur plugin</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../../../index.html">Module code</a> &raquo;</li>
      
    <li>aiida.orm.calculation.job.fleur_inp.fleurinputgen</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aiida.orm.calculation.job.fleur_inp.fleurinputgen</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Input plug-in for the FLEUR input generator &#39;inpgen&#39;.</span>
<span class="sd">The input generator for the Fleur code is a preprocessor</span>
<span class="sd">and should be run localy (with the direct scheduler) or inline,</span>
<span class="sd">because it does not take many resources.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">aiida</span> <span class="kn">import</span> <span class="n">load_dbenv</span><span class="p">,</span> <span class="n">is_dbenv_loaded</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">is_dbenv_loaded</span><span class="p">():</span>
    <span class="n">load_dbenv</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">aiida.orm.calculation.job</span> <span class="kn">import</span> <span class="n">JobCalculation</span>
<span class="kn">from</span> <span class="nn">aiida.common.exceptions</span> <span class="kn">import</span> <span class="n">InputValidationError</span>
<span class="kn">from</span> <span class="nn">aiida.common.datastructures</span> <span class="kn">import</span> <span class="n">CalcInfo</span><span class="p">,</span> <span class="n">CodeInfo</span>
<span class="kn">from</span> <span class="nn">aiida.common.constants</span> <span class="kn">import</span> <span class="n">elements</span> <span class="k">as</span> <span class="n">PeriodicTableElements</span>
<span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="kn">import</span> <span class="n">DataFactory</span>
<span class="kn">from</span> <span class="nn">aiida.common.utils</span> <span class="kn">import</span> <span class="n">classproperty</span>
<span class="kn">from</span> <span class="nn">aiida.tools.codespecific.fleur.StructureData_util</span> <span class="kn">import</span> <span class="n">abs_to_rel_f</span><span class="p">,</span> <span class="n">abs_to_rel</span>
<span class="kn">from</span> <span class="nn">aiida.tools.codespecific.fleur.xml_util</span> <span class="kn">import</span> <span class="n">convert_to_fortran_bool</span><span class="p">,</span> <span class="n">convert_to_fortran_string</span>

<span class="n">__copyright__</span> <span class="o">=</span> <span class="s">u&quot;Copyright (c), 2016, Forschungszentrum JÃ¼lich GmbH, IAS-1/PGI-1, Germany. All rights reserved.&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s">&quot;MIT license, see LICENSE.txt file&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;0.27&quot;</span>
<span class="n">__contributors__</span> <span class="o">=</span> <span class="s">&quot;Jens Broeder&quot;</span>

<span class="n">bohr_a</span> <span class="o">=</span> <span class="mf">0.52917721092</span><span class="c">#A # TODO import from somewhere</span>
<span class="n">StructureData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s">&#39;structure&#39;</span><span class="p">)</span>
<span class="n">ParameterData</span> <span class="o">=</span> <span class="n">DataFactory</span><span class="p">(</span><span class="s">&#39;parameter&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="FleurinputgenCalculation"><a class="viewcode-back" href="../../../../../../code.html#aiida.orm.calculation.job.fleur_inp.fleurinputgen.FleurinputgenCalculation">[docs]</a><span class="k">class</span> <span class="nc">FleurinputgenCalculation</span><span class="p">(</span><span class="n">JobCalculation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    JobCalculationClass for the Inputgenerator, which is a preprocessor for a FLEUR calculation. Here is implemented how an input file for &#39;inpgen&#39; is written from AiiDA data objects.</span>
<span class="sd">    For more information about produced files and the FLEUR-code family, go to http://www.flapw.de/.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#### (Maintain) if inputgen keys change ####</span>

    <span class="k">def</span> <span class="nf">_init_internal_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FleurinputgenCalculation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_init_internal_params</span><span class="p">()</span>

        <span class="c"># Default fleur output parser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_parser</span> <span class="o">=</span> <span class="s">&#39;fleur_inp.fleur_inputgen&#39;</span>

        <span class="c"># Default input and output files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_INPUT_FILE</span> <span class="o">=</span> <span class="s">&#39;aiida.in&#39;</span> <span class="c"># will be shown with inputcat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_OUTPUT_FILE</span> <span class="o">=</span> <span class="s">&#39;out&#39;</span> <span class="c">#&#39;shell.out&#39; #will be shown with outputcat</span>

        <span class="c"># created file names, some needed for Fleur calc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_INPXML_FILE_NAME</span> <span class="o">=</span> <span class="s">&#39;inp.xml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_INPUT_FILE_NAME</span> <span class="o">=</span> <span class="s">&#39;aiida.in&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SHELLOUT_FILE_NAME</span> <span class="o">=</span> <span class="s">&#39;shell.out&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_OUTPUT_FILE_NAME</span> <span class="o">=</span> <span class="s">&#39;out&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ERROR_FILE_NAME</span> <span class="o">=</span> <span class="s">&#39;out.error&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_STRUCT_FILE_NAME</span> <span class="o">=</span> <span class="s">&#39;struct.xsf&#39;</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self._INP_FILE_NAME = &#39;inp&#39;</span>
<span class="sd">        self._ENPARA_FILE_NAME = &#39;enpara&#39;</span>
<span class="sd">        self._SYMOUT_FILE_NAME = &#39;sym.out&#39;</span>
<span class="sd">        self._FORT_FILE_NAME = &#39;fort93&#39;</span>
<span class="sd">        self._CORELEVEL_FILE_NAME = &#39;corelevels.&#39; # Add coordination number</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="c"># TODO switch all these to init_interal_params?</span>
    <span class="n">_OUTPUT_SUBFOLDER</span> <span class="o">=</span> <span class="s">&#39;./fleur_inp_out/&#39;</span>
    <span class="n">_PREFIX</span> <span class="o">=</span> <span class="s">&#39;aiida&#39;</span>

    <span class="c"># Additional files that should always be retrieved for the specific plugin</span>
    <span class="n">_internal_retrieve_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_automatic_namelists</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c"># Specify here what namelist and parameters the inpgen takes</span>
    <span class="c">#TODO: complete?</span>
    <span class="n">_possible_namelists</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="s">&#39;lattice&#39;</span><span class="p">,</span> <span class="s">&#39;gen&#39;</span><span class="p">,</span> <span class="s">&#39;shift&#39;</span><span class="p">,</span> <span class="s">&#39;factor&#39;</span><span class="p">,</span> <span class="s">&#39;qss&#39;</span><span class="p">,</span>
                           <span class="s">&#39;soc&#39;</span><span class="p">,</span> <span class="s">&#39;atom&#39;</span><span class="p">,</span> <span class="s">&#39;comp&#39;</span><span class="p">,</span> <span class="s">&#39;exco&#39;</span><span class="p">,</span> <span class="s">&#39;film&#39;</span><span class="p">,</span> <span class="s">&#39;kpt&#39;</span><span class="p">,</span> <span class="s">&#39;end&#39;</span><span class="p">]</span>
                           <span class="c"># this order is important!</span>
    <span class="n">_possible_params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;input&#39;</span><span class="p">:[</span><span class="s">&#39;film&#39;</span><span class="p">,</span> <span class="s">&#39;cartesian&#39;</span><span class="p">,</span> <span class="s">&#39;cal_symm&#39;</span><span class="p">,</span> <span class="s">&#39;checkinp&#39;</span><span class="p">,</span>
                                 <span class="s">&#39;symor&#39;</span><span class="p">,</span> <span class="s">&#39;oldfleur&#39;</span><span class="p">],</span>
                        <span class="s">&#39;lattice&#39;</span><span class="p">:[</span><span class="s">&#39;latsys&#39;</span><span class="p">,</span> <span class="s">&#39;a0&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;alpha&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;beta&#39;</span><span class="p">,</span> <span class="s">&#39;gamma&#39;</span><span class="p">],</span>
                        <span class="s">&#39;atom&#39;</span><span class="p">:[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="s">&#39;rmt&#39;</span><span class="p">,</span> <span class="s">&#39;dx&#39;</span><span class="p">,</span> <span class="s">&#39;jri&#39;</span><span class="p">,</span> <span class="s">&#39;lmax&#39;</span><span class="p">,</span>
                                <span class="s">&#39;lnonsph&#39;</span><span class="p">,</span> <span class="s">&#39;ncst&#39;</span><span class="p">,</span> <span class="s">&#39;econfig&#39;</span><span class="p">,</span> <span class="s">&#39;bmu&#39;</span><span class="p">,</span> <span class="s">&#39;lo&#39;</span><span class="p">,</span>
                                <span class="s">&#39;element&#39;</span><span class="p">],</span>
                        <span class="s">&#39;comp&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;jspins&#39;</span><span class="p">,</span> <span class="s">&#39;frcor&#39;</span><span class="p">,</span> <span class="s">&#39;ctail&#39;</span><span class="p">,</span> <span class="s">&#39;kcrel&#39;</span><span class="p">,</span> <span class="s">&#39;gmax&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;gmaxxc&#39;</span><span class="p">,</span> <span class="s">&#39;kmax&#39;</span><span class="p">],</span>
                        <span class="s">&#39;exco&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;xctyp&#39;</span><span class="p">,</span> <span class="s">&#39;relxc&#39;</span><span class="p">],</span>
                        <span class="s">&#39;film&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;dvac&#39;</span><span class="p">,</span> <span class="s">&#39;dtild&#39;</span><span class="p">],</span>
                        <span class="s">&#39;soc&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;theta&#39;</span><span class="p">,</span> <span class="s">&#39;phi&#39;</span><span class="p">],</span>
                        <span class="s">&#39;qss&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">],</span>
                        <span class="s">&#39;kpt&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;nkpt&#39;</span><span class="p">,</span> <span class="s">&#39;kpts&#39;</span><span class="p">,</span> <span class="s">&#39;div1&#39;</span><span class="p">,</span> <span class="s">&#39;div2&#39;</span><span class="p">,</span> <span class="s">&#39;div3&#39;</span><span class="p">,</span>
                                 <span class="s">&#39;tkb&#39;</span><span class="p">,</span> <span class="s">&#39;tria&#39;</span><span class="p">],</span>
                        <span class="s">&#39;title&#39;</span> <span class="p">:</span> <span class="p">{}</span>
                       <span class="p">}</span>

    <span class="c"># Keywords that cannot be set</span>
    <span class="c"># TODO: To specify what combinations are not allowed together,</span>
    <span class="c"># or not at all (lattice ?, shift, scale)</span>
    <span class="n">_blocked_keywords</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c"># TODO different kpt mody? (use kpointNode)? FleurinpdData can do it.</span>
    <span class="n">_use_kpoints</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c"># If two lattices are given, via the input &amp;lattice</span>
    <span class="c"># and the aiida structure prefare the aiida structure?</span>
    <span class="c"># currently is not allow the use of &amp;lattice</span>
    <span class="n">_use_aiida_structure</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c"># Default title</span>
    <span class="n">_inp_title</span> <span class="o">=</span> <span class="s">&#39;A Fleur input generator calulation with aiida&#39;</span>


    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_use_methods</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extend the parent _use_methods with further keys.</span>
<span class="sd">        specifies what nodes have to be in calculation TODO: decide what is</span>
<span class="sd">        settings and what is parameters, sturcture might not be needed</span>
<span class="sd">        if &amp;lattice is defined in inp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retdict</span> <span class="o">=</span> <span class="n">JobCalculation</span><span class="o">.</span><span class="n">_use_methods</span>
        <span class="n">retdict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s">&quot;structure&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&#39;valid_types&#39;</span><span class="p">:</span> <span class="n">StructureData</span><span class="p">,</span>
                <span class="s">&#39;additional_parameter&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s">&#39;linkname&#39;</span><span class="p">:</span> <span class="s">&#39;structure&#39;</span><span class="p">,</span>
                <span class="s">&#39;docstring&#39;</span><span class="p">:</span> <span class="s">&quot;Choose the input structure to use&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="s">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&#39;valid_types&#39;</span><span class="p">:</span> <span class="n">ParameterData</span><span class="p">,</span>
                <span class="s">&#39;additional_parameter&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s">&#39;linkname&#39;</span><span class="p">:</span> <span class="s">&#39;parameters&#39;</span><span class="p">,</span>
                <span class="s">&#39;docstring&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;Use a node that specifies the input parameters &quot;</span>
                              <span class="s">&quot;for the namelists&quot;</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">})</span>
        <span class="k">return</span> <span class="n">retdict</span>


    <span class="k">def</span> <span class="nf">_prepare_for_submission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tempfolder</span><span class="p">,</span> <span class="n">inputdict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is the routine to be called when you want to create</span>
<span class="sd">        the input files for the inpgen with the plug-in.</span>

<span class="sd">        :param tempfolder: a aiida.common.folders.Folder subclass where</span>
<span class="sd">                           the plugin should put all its files.</span>
<span class="sd">        :param inputdict: a dictionary with the input nodes, as they would</span>
<span class="sd">                be returned by get_inputdata_dict (without the Code!)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c">#from aiida.common.utils import get_unique_filename, get_suggestion</span>
        <span class="c">#import re</span>

        <span class="c"># Get the connection between coordination number and element symbol</span>
        <span class="c"># maybe do in a differnt way</span>
        <span class="n">_atomic_numbers</span> <span class="o">=</span> <span class="p">{</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;symbol&#39;</span><span class="p">]:</span> <span class="n">num</span> <span class="k">for</span> <span class="n">num</span><span class="p">,</span>
                           <span class="n">data</span> <span class="ow">in</span> <span class="n">PeriodicTableElements</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()}</span>

        <span class="n">possible_namelists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_possible_namelists</span>
        <span class="n">possible_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_possible_params</span>
        <span class="n">local_copy_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">remote_copy_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">remote_symlink_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bulk</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">film</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># convert these &#39;booleans&#39; to the inpgen format.</span>
        <span class="n">replacer_values_bool</span> <span class="o">=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;True&#39;</span><span class="p">,</span> <span class="s">&#39;False&#39;</span><span class="p">,</span> <span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="s">&#39;T&#39;</span><span class="p">,</span>
                                <span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">]</span>
        <span class="c"># some keywords require a string &quot; around them in the input file.</span>
        <span class="n">string_replace</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;econfig&#39;</span><span class="p">,</span> <span class="s">&#39;lo&#39;</span><span class="p">,</span> <span class="s">&#39;element&#39;</span><span class="p">]</span>

        <span class="c"># of some keys only the values are writen to the file, specify them here.</span>
        <span class="n">val_only_namelist</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;soc&#39;</span><span class="p">,</span> <span class="s">&#39;qss&#39;</span><span class="p">]</span>

        <span class="c"># Scaling comes from the Structure</span>
        <span class="c"># but we have to convert from Angstroem to a.u (bohr radii)</span>
        <span class="n">scaling_factors</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span> <span class="c">#</span>
        <span class="n">scaling_lat</span> <span class="o">=</span> <span class="mf">1.</span><span class="c">#/bohr_a</span>
        <span class="n">scaling_pos</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">bohr_a</span> <span class="c"># Angstrom to atomic</span>
        <span class="n">own_lattice</span> <span class="o">=</span> <span class="bp">False</span> <span class="c">#not self._use_aiida_structure</span>

        <span class="c"># The inpfile gen is run in serial TODO: How to do this by default?</span>
        <span class="c">#self.set_withmpi(False)</span>

        <span class="c">##########################################</span>
        <span class="c">############# INPUT CHECK ################</span>
        <span class="c">##########################################</span>

        <span class="c"># first check existence of structure and if 1D, 2D, 3D</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="n">inputdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_linkname</span><span class="p">(</span><span class="s">&#39;structure&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span><span class="s">&quot;No structure specified for this&quot;</span>
                                       <span class="s">&quot; calculation&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">StructureData</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span>
                       <span class="s">&quot;structure is not of type StructureData&quot;</span><span class="p">)</span>

        <span class="n">pbc</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">pbc</span>
        <span class="k">if</span> <span class="bp">False</span> <span class="ow">in</span> <span class="n">pbc</span><span class="p">:</span>
            <span class="n">bulk</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">film</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># check existence of parameters (optional)</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">inputdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_linkname</span><span class="p">(</span><span class="s">&#39;parameters&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># use default</span>
            <span class="n">parameters_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">ParameterData</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span><span class="s">&quot;parameters, if specified, must be of &quot;</span>
                                           <span class="s">&quot;type ParameterData&quot;</span><span class="p">)</span>
            <span class="n">parameters_dict</span> <span class="o">=</span> <span class="n">_lowercase_dict</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">get_dict</span><span class="p">(),</span>
                                              <span class="n">dict_name</span><span class="o">=</span><span class="s">&#39;parameters&#39;</span><span class="p">)</span>

        <span class="c"># we write always out rel coordinates, because thats the way FLEUR uses</span>
        <span class="c"># them best. we have to convert them from abs, becauses thats how they</span>
        <span class="c">#are stored in a Structure node. cartesian=F is default</span>
        <span class="k">if</span> <span class="s">&#39;input&#39;</span> <span class="ow">in</span> <span class="n">parameters_dict</span><span class="p">:</span>
            <span class="n">parameters_dict</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">][</span><span class="s">&#39;cartesian&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">film</span><span class="p">:</span>
                <span class="n">parameters_dict</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">][</span><span class="s">&#39;film&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bulk</span><span class="p">:</span>
                <span class="n">parameters_dict</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;cartesian&#39;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
            <span class="k">elif</span> <span class="n">film</span><span class="p">:</span>
                <span class="n">parameters_dict</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;cartesian&#39;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;film&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">}</span>

        <span class="n">namelists_toprint</span> <span class="o">=</span> <span class="n">possible_namelists</span>

        <span class="c"># check parameters keys TODO: values needed, or keep plug-in as stupid as possible?</span>
        <span class="c">#if parameters_dict:# TODO remove, unnesseary now?</span>
        <span class="n">input_params</span> <span class="o">=</span> <span class="n">parameters_dict</span>
        <span class="c">#TODO:?make everything lowercase in the database, and change it to inpgen format?</span>
        <span class="c">#_lowercase_dict(parameters.get_dict(),</span>
                                         <span class="c">#dict_name=&#39;parameters&#39;)</span>
        <span class="c">#input_params = {k: _lowercase_dict(val, dict_name=k)</span>
        <span class="c">#                   for k, val in input_params.iteritems()}</span>
        <span class="c">#input_params_keys = input_params.keys()</span>

        <span class="k">if</span> <span class="s">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">input_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inp_title</span> <span class="o">=</span> <span class="n">input_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">)</span>
        <span class="c">#TODO validate type of values of the input parameter keys ?</span>

        <span class="c">#check input_parameters</span>
        <span class="k">for</span> <span class="n">namelist</span><span class="p">,</span> <span class="n">paramdic</span> <span class="ow">in</span> <span class="n">input_params</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="s">&#39;atom&#39;</span> <span class="ow">in</span> <span class="n">namelist</span><span class="p">:</span> <span class="c"># this namelist can be specified more often</span>
                <span class="c"># special atom namelist needs to be set for writing,</span>
                <span class="c">#  but insert it in the right spot! </span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">namelists_toprint</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;atom&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">namelists_toprint</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">namelist</span><span class="p">)</span>
                <span class="n">namelist</span> <span class="o">=</span> <span class="s">&#39;atom&#39;</span>
            <span class="k">if</span> <span class="n">namelist</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">possible_namelists</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span>
                    <span class="s">&quot;The namelist &#39;{}&#39; is not supported by the fleur&quot;</span>
                    <span class="s">&quot; inputgenerator. Check on the fleur website or add &#39;{}&#39;&quot;</span>
                    <span class="s">&quot;to _possible_namelists.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">namelist</span><span class="p">,</span> <span class="n">namelist</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">paramdic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">para</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">possible_params</span><span class="p">[</span><span class="n">namelist</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span>
                        <span class="s">&quot;The property &#39;{}&#39; is not supported by the &quot;</span>
                        <span class="s">&quot;namelist &#39;{}&#39;. &quot;</span>
                        <span class="s">&quot;Check the fleur website, or if it really is,&quot;</span>
                        <span class="s">&quot; update _possible_params. &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">para</span><span class="p">,</span> <span class="n">namelist</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">paramdic</span><span class="p">[</span><span class="n">para</span><span class="p">]</span> <span class="ow">in</span> <span class="n">replacer_values_bool</span><span class="p">:</span>
                    <span class="c"># because 1/1.0 == True, and 0/0.0 == False</span>
                    <span class="c"># maybe change in convert_to_fortran that no error occurs</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paramdic</span><span class="p">[</span><span class="n">para</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paramdic</span><span class="p">[</span><span class="n">para</span><span class="p">],</span> <span class="nb">bool</span><span class="p">):</span>
                            <span class="n">paramdic</span><span class="p">[</span><span class="n">para</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_to_fortran_bool</span><span class="p">(</span><span class="n">paramdic</span><span class="p">[</span><span class="n">para</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">paramdic</span><span class="p">[</span><span class="n">para</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_to_fortran_bool</span><span class="p">(</span><span class="n">paramdic</span><span class="p">[</span><span class="n">para</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">string_replace</span><span class="p">:</span>
                    <span class="c">#TODO check if its in the parameter dict</span>
                    <span class="c">#print para</span>
                    <span class="n">paramdic</span><span class="p">[</span><span class="n">para</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_to_fortran_string</span><span class="p">(</span><span class="n">paramdic</span><span class="p">[</span><span class="n">para</span><span class="p">])</span>
                    <span class="c">#print &quot;{}&quot;.format(paramdic[para])</span>
            <span class="c">#in fleur it is possible to give a lattice namelist</span>
            <span class="k">if</span> <span class="s">&#39;lattice&#39;</span> <span class="ow">in</span> <span class="n">input_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">own_lattice</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">structure</span> <span class="o">=</span> <span class="n">inputdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_linkname</span><span class="p">(</span><span class="s">&#39;structure&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">structure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c">#two structures given?</span>
                    <span class="c">#which one should be prepared? TODO: print warning or even error</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_aiida_structure</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">StructureData</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span><span class="s">&quot;structure is not of type&quot;</span>
                                                       <span class="s">&quot; StructureData&quot;</span><span class="p">)</span>
                        <span class="n">input_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;lattice&#39;</span><span class="p">,</span> <span class="p">{})</span>
                        <span class="n">own_lattice</span> <span class="o">=</span> <span class="bp">False</span>




        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        # TODO allow only usual kpt meshes and use therefore Aiida kpointData</span>
<span class="sd">        if self._use_kpoints:</span>
<span class="sd">            try:</span>
<span class="sd">                kpoints = inputdict.pop(self.get_linkname(&#39;kpoints&#39;))</span>
<span class="sd">            except KeyError:</span>
<span class="sd">                raise InputValidationError(&quot;No kpoints specified for this&quot;</span>
<span class="sd">                                           &quot; calculation&quot;)</span>
<span class="sd">            if not isinstance(kpoints, KpointsData):</span>
<span class="sd">                raise InputValidationError(&quot;kpoints is not of type KpointsData&quot;)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c">#TODO I think the code should not be in the input dict. check local,</span>
        <span class="c"># verus remote, codeinfos, one several codes..</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">inputdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_linkname</span><span class="p">(</span><span class="s">&#39;code&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span><span class="s">&quot;No code specified for this &quot;</span>
                                       <span class="s">&quot;calculation&quot;</span><span class="p">)</span>

        <span class="c"># Here, there should be no more parameters...</span>
        <span class="k">if</span> <span class="n">inputdict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span>
                <span class="s">&quot;The following input data nodes are &quot;</span>
                <span class="s">&quot;unrecognized: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inputdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="c">##############################</span>
        <span class="c"># END OF INITIAL INPUT CHECK #</span>

        <span class="c">#######################################################</span>
        <span class="c">######### PREPARE PARAMETERS FOR INPUT FILE ###########</span>

        <span class="c">#### STRUCTURE_PARAMETERS ####</span>

        <span class="n">scaling_factor_card</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">cell_parameters_card</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">own_lattice</span><span class="p">:</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">cell</span>
            <span class="k">for</span> <span class="n">vector</span> <span class="ow">in</span> <span class="n">cell</span><span class="p">:</span>
                <span class="n">scaled</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="n">scaling_pos</span> <span class="k">for</span> <span class="n">a</span>  <span class="ow">in</span> <span class="n">vector</span><span class="p">]</span><span class="c">#scaling_pos=1./bohr_a</span>
                <span class="n">cell_parameters_card</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&quot;{0:18.10f} {1:18.10f} {2:18.10f}&quot;</span>
                                         <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scaled</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">scaled</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scaled</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">scaling_factor_card</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&quot;{0:18.10f} {1:18.10f} {2:18.10f}&quot;</span>
                                    <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scaling_factors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                <span class="n">scaling_factors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                <span class="n">scaling_factors</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>


        <span class="c">#### ATOMIC_POSITIONS ####</span>

        <span class="c"># TODO: be careful with units</span>
        <span class="n">atomic_positions_card_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">]</span>
        <span class="c"># Fleur does not have any keyword before the atomic species.</span>
        <span class="c"># first the number of atoms then the form nuclear charge, postion</span>
        <span class="c"># Fleur hast the option of nuclear charge as floats,</span>
        <span class="c"># allows the user to distinguish two atoms and break the symmetry.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">own_lattice</span><span class="p">:</span>
            <span class="n">natoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span>
            <span class="c">#for FLEUR true, general not, because you could put several</span>
            <span class="c"># atoms on a site</span>
            <span class="c"># TODO: test that only one atom at site?</span>
            <span class="n">atomic_positions_card_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;    {0:3}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">natoms</span><span class="p">))</span>

            <span class="c"># TODO this feature might change in Fleur, do different. that in inpgen kind gets a name, which will also be the name in fleur inp.xml.</span>
            <span class="c"># now user has to make kind_name = atom id.</span>
            <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">:</span>
                <span class="n">kind_name</span> <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">kind_name</span>
                <span class="n">site_symbol</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">get_kind</span><span class="p">(</span><span class="n">kind_name</span><span class="p">)</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># TODO: list I assume atoms therefore I just get the first one...</span>
                <span class="n">atomic_number</span> <span class="o">=</span> <span class="n">_atomic_numbers</span><span class="p">[</span><span class="n">site_symbol</span><span class="p">]</span>
                <span class="n">atomic_number_name</span> <span class="o">=</span> <span class="n">atomic_number</span>
                <span class="k">if</span> <span class="n">site_symbol</span> <span class="o">!=</span> <span class="n">kind_name</span><span class="p">:</span>
                    <span class="n">suc</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">head</span> <span class="o">=</span> <span class="n">kind_name</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;0123456789&#39;</span><span class="p">)</span>
                        <span class="n">kind_namet</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kind_name</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">head</span><span class="p">):])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">suc</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">if</span> <span class="n">suc</span><span class="p">:</span>
                        <span class="n">atomic_number_name</span> <span class="o">=</span> <span class="s">&#39;{}.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atomic_number</span><span class="p">,</span> <span class="n">kind_namet</span><span class="p">)</span>
                <span class="c"># per default we use relative coordinates in Fleur</span>
                <span class="c"># we have to scale back to atomic units from angstrom</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">position</span>
                <span class="k">print</span> <span class="s">&#39;pos {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bulk</span><span class="p">:</span>
                    <span class="n">vector_rel</span> <span class="o">=</span> <span class="n">abs_to_rel</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">film</span><span class="p">:</span>
                    <span class="n">vector_rel</span> <span class="o">=</span> <span class="n">abs_to_rel_f</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">structure</span><span class="o">.</span><span class="n">pbc</span><span class="p">)</span>
                    <span class="n">vector_rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">vector_rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">scaling_pos</span>
                <span class="n">atomic_positions_card_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s">&quot;    {0:3} {1:18.10f} {2:18.10f} {3:18.10f}&quot;</span>
                    <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atomic_number_name</span><span class="p">,</span>
                                <span class="n">vector_rel</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vector_rel</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">vector_rel</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="c">#print atomic_positions_card_list</span>
                <span class="c">#TODO check format</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># TODO with own lattice atomic positions have to come from somewhere</span>
            <span class="c"># else.... User input?</span>
            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span><span class="s">&quot;fleur lattice needs also the atom &quot;</span>
                                       <span class="s">&quot; position as input,&quot;</span>
                                       <span class="s">&quot; not implemented yet, sorry!&quot;</span><span class="p">)</span>
        <span class="n">atomic_positions_card</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">atomic_positions_card_list</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">atomic_positions_card_list</span> <span class="c"># Free memory</span>

        <span class="c">#### Kpts ####</span>

        <span class="c"># TODO: kpts</span>
        <span class="c">#kpoints_card = &quot;&quot;#.join(kpoints_card_list)</span>
        <span class="c">#del kpoints_card_list</span>

        <span class="c">#######################################</span>
        <span class="c">#### WRITE ALL CARDS IN INPUT FILE ####</span>

        <span class="n">input_filename</span> <span class="o">=</span> <span class="n">tempfolder</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_INPUT_FILE_NAME</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>

            <span class="c">#first write title</span>
            <span class="n">infile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inp_title</span><span class="p">))</span>

            <span class="c">#then write &amp;input namelist</span>
            <span class="n">infile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&amp;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;input&#39;</span><span class="p">))</span>

            <span class="c"># namelist content; set to {} if not present, so that we leave an</span>
            <span class="c"># empty namelist</span>
            <span class="n">namelist</span> <span class="o">=</span> <span class="n">input_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">namelist</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
                <span class="n">infile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">get_input_data_text</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span>
            <span class="n">infile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;/</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="c"># Write lattice information now</span>
            <span class="n">infile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cell_parameters_card</span><span class="p">)</span>
            <span class="n">infile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{0:18.10f}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scaling_lat</span><span class="p">))</span>
            <span class="n">infile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">scaling_factor_card</span><span class="p">)</span>
            <span class="n">infile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="c"># Write Atomic positons</span>
            <span class="n">infile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">atomic_positions_card</span><span class="p">)</span>

            <span class="c"># Write namelists after atomic positions</span>
            <span class="k">for</span> <span class="n">namels_name</span> <span class="ow">in</span> <span class="n">namelists_toprint</span><span class="p">:</span>
                <span class="n">namelist</span> <span class="o">=</span> <span class="n">input_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">namels_name</span><span class="p">,</span> <span class="p">{})</span>
                <span class="k">if</span> <span class="n">namelist</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s">&#39;atom&#39;</span> <span class="ow">in</span> <span class="n">namels_name</span><span class="p">:</span>
                        <span class="n">namels_name</span> <span class="o">=</span> <span class="s">&#39;atom&#39;</span>
                    <span class="n">infile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&amp;{0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">namels_name</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">namels_name</span> <span class="ow">in</span> <span class="n">val_only_namelist</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">namelist</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
                            <span class="n">infile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">get_input_data_text</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">namelist</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
                            <span class="n">infile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">get_input_data_text</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span>
                    <span class="n">infile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;/</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="c">#infile.write(kpoints_card)</span>

        <span class="k">if</span> <span class="n">input_params</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span>
                <span class="s">&quot;input_params leftover: The following namelists are specified&quot;</span>
                <span class="s">&quot; in input_params, but are &quot;</span>
                <span class="s">&quot;not valid namelists for the current type of calculation: &quot;</span>
                <span class="s">&quot;{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_params</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>


        <span class="n">calcinfo</span> <span class="o">=</span> <span class="n">CalcInfo</span><span class="p">()</span>

        <span class="n">calcinfo</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uuid</span>

        <span class="n">calcinfo</span><span class="o">.</span><span class="n">local_copy_list</span> <span class="o">=</span> <span class="n">local_copy_list</span>
        <span class="n">calcinfo</span><span class="o">.</span><span class="n">remote_copy_list</span> <span class="o">=</span> <span class="n">remote_copy_list</span>
        <span class="n">calcinfo</span><span class="o">.</span><span class="n">remote_symlink_list</span> <span class="o">=</span> <span class="n">remote_symlink_list</span>

        <span class="c"># Retrieve per default only out file and inp.xml file?</span>
        <span class="n">calcinfo</span><span class="o">.</span><span class="n">retrieve_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># TODO: let the user specify?</span>
        <span class="c">#settings_retrieve_list = settings_dict.pop(</span>
        <span class="c">#                             &#39;ADDITIONAL_RETRIEVE_LIST&#39;, [])</span>
        <span class="n">calcinfo</span><span class="o">.</span><span class="n">retrieve_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_INPXML_FILE_NAME</span><span class="p">)</span>
        <span class="n">calcinfo</span><span class="o">.</span><span class="n">retrieve_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_OUTPUT_FILE_NAME</span><span class="p">)</span>
        <span class="n">calcinfo</span><span class="o">.</span><span class="n">retrieve_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SHELLOUT_FILE_NAME</span><span class="p">)</span>
        <span class="n">calcinfo</span><span class="o">.</span><span class="n">retrieve_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ERROR_FILE_NAME</span><span class="p">)</span>
        <span class="n">calcinfo</span><span class="o">.</span><span class="n">retrieve_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_STRUCT_FILE_NAME</span><span class="p">)</span>
        <span class="n">calcinfo</span><span class="o">.</span><span class="n">retrieve_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_INPUT_FILE_NAME</span><span class="p">)</span>
        <span class="c">#calcinfo.retrieve_list += settings_retrieve_list</span>
        <span class="c">#calcinfo.retrieve_list += self._internal_retrieve_list</span>

        <span class="n">codeinfo</span> <span class="o">=</span> <span class="n">CodeInfo</span><span class="p">()</span>
        <span class="n">cmdline_params</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;-explicit&quot;</span><span class="p">]</span> <span class="c"># TODO? let the user decide</span>
        <span class="n">codeinfo</span><span class="o">.</span><span class="n">cmdline_params</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cmdline_params</span><span class="p">))</span>

        <span class="n">codeinfo</span><span class="o">.</span><span class="n">code_uuid</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">uuid</span>
        <span class="n">codeinfo</span><span class="o">.</span><span class="n">stdin_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_INPUT_FILE_NAME</span>
        <span class="n">codeinfo</span><span class="o">.</span><span class="n">stdout_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SHELLOUT_FILE_NAME</span> <span class="c"># shell output will be piped in file</span>
        <span class="n">codeinfo</span><span class="o">.</span><span class="n">stderr_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ERROR_FILE_NAME</span> <span class="c"># std error too</span>

        <span class="n">calcinfo</span><span class="o">.</span><span class="n">codes_info</span> <span class="o">=</span> <span class="p">[</span><span class="n">codeinfo</span><span class="p">]</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        if settings_dict:</span>
<span class="sd">            try:</span>
<span class="sd">                Parserclass = self.get_parserclass()</span>
<span class="sd">                parser = Parserclass(self)</span>
<span class="sd">                parser_opts = parser.get_parser_settings_key()</span>
<span class="sd">                settings_dict.pop(parser_opts)</span>
<span class="sd">            except (KeyError, AttributeError): # the key parser_opts isn&#39;t</span>
<span class="sd">                                              # inside the dictionary</span>
<span class="sd">                raise InputValidationError(</span>
<span class="sd">                    &quot;The following keys have been found in the settings &quot;</span>
<span class="sd">                    &quot;input node, but were not understood: {}&quot;</span>
<span class="sd">                    &quot;&quot;.format(&quot;,&quot;.join(settings_dict.keys())))</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">calcinfo</span>
</div>
<div class="viewcode-block" id="get_input_data_text"><a class="viewcode-back" href="../../../../../../code.html#aiida.orm.calculation.job.fleur_inp.fleurinputgen.get_input_data_text">[docs]</a><span class="k">def</span> <span class="nf">get_input_data_text</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">value_only</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span><span class="c">#TODO rewrite for fleur/ delete unnessesariy parts</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a key and a value, return a string (possibly multiline for arrays)</span>
<span class="sd">    with the text to be added to the input file.</span>

<span class="sd">    :param key: the flag name</span>
<span class="sd">    :param val: the flag value. If it is an array, a line for each element</span>
<span class="sd">            is produced, with variable indexing starting from 1.</span>
<span class="sd">            Each value is formatted using the conv_to_fortran function.</span>
<span class="sd">    :param mapping: Optional parameter, must be provided if val is a dictionary.</span>
<span class="sd">            It maps each key of the &#39;val&#39; dictionary to the corresponding</span>
<span class="sd">            list index. For instance, if ``key=&#39;magn&#39;``,</span>
<span class="sd">            ``val = {&#39;Fe&#39;: 0.1, &#39;O&#39;: 0.2}`` and ``mapping = {&#39;Fe&#39;: 2, &#39;O&#39;: 1}``,</span>
<span class="sd">            this function will return the two lines ``magn(1) = 0.2`` and</span>
<span class="sd">            ``magn(2) = 0.1``. This parameter is ignored if &#39;val&#39;</span>
<span class="sd">            is not a dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">aiida.common.utils</span> <span class="kn">import</span> <span class="n">conv_to_fortran</span>
    <span class="c"># I don&#39;t try to do iterator=iter(val) and catch TypeError because</span>
    <span class="c"># it would also match strings</span>
    <span class="c"># I check first the dictionary, because it would also matc</span>
    <span class="c"># hasattr(__iter__)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;If &#39;val&#39; is a dictionary, you must provide also &quot;</span>
                             <span class="s">&quot;the &#39;mapping&#39; parameter&quot;</span><span class="p">)</span>

        <span class="c"># At difference with the case of a list, at the beginning</span>
        <span class="c"># list_of_strings</span>
        <span class="c"># is a list of 2-tuples where the first element is the idx, and the</span>
        <span class="c"># second is the actual line. This is used at the end to</span>
        <span class="c"># resort everything.</span>
        <span class="n">list_of_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elemk</span><span class="p">,</span> <span class="n">itemval</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">elemk</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Unable to find the key &#39;{}&#39; in the mapping &quot;</span>
                                 <span class="s">&quot;dictionary&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elemk</span><span class="p">))</span>

            <span class="n">list_of_strings</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
                <span class="n">idx</span><span class="p">,</span> <span class="s">&quot;  {0}({2})={1} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">conv_to_fortran</span><span class="p">(</span><span class="n">itemval</span><span class="p">),</span> <span class="n">idx</span><span class="p">)))</span>
                <span class="c">#changed {0}({2}) = {1}\n&quot;.format</span>

        <span class="c"># I first have to resort, then to remove the index from the first</span>
        <span class="c"># column, finally to join the strings</span>
        <span class="n">list_of_strings</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">list_of_strings</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_of_strings</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value_only</span><span class="p">:</span>
            <span class="n">list_of_strings</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s">&quot;  ({1}){0} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conv_to_fortran</span><span class="p">(</span><span class="n">itemval</span><span class="p">),</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">itemval</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">val</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># a list/array/tuple of values</span>
            <span class="n">list_of_strings</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s">&quot;  {0}({2})={1} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">conv_to_fortran</span><span class="p">(</span><span class="n">itemval</span><span class="p">),</span>
                                         <span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">itemval</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">val</span><span class="p">)]</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_of_strings</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># single value</span>
        <span class="c">#return &quot;  {0}={1} &quot;.format(key, conv_to_fortran(val))</span>
        <span class="k">if</span> <span class="n">value_only</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot; {0} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;  {0}={1} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

<span class="c"># TODO import from QE?</span></div>
<span class="k">def</span> <span class="nf">_lowercase_dict</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">dict_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    converts every entry in a dictionary to lowercase</span>
<span class="sd">    :param dic: parameters dictionary</span>
<span class="sd">    :param dict_name: dictionary name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">new_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_dict</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dic</span><span class="p">):</span>
            <span class="n">num_items</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">double_keys</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">num_items</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">raise</span> <span class="n">InputValidationError</span><span class="p">(</span>
                <span class="s">&quot;Inside the dictionary &#39;{}&#39; there are the following keys that &quot;</span>
                <span class="s">&quot;are repeated more than once when compared case-insensitively:&quot;</span>
                <span class="s">&quot;{}.This is not allowed.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dict_name</span><span class="p">,</span> <span class="n">double_keys</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">new_dict</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;_lowercase_dict accepts only dictionaries as argument&quot;</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Jens Broeder.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../../',
            VERSION:'0.27 beta',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>